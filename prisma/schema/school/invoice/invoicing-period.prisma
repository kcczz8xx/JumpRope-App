// ============================================
// 到校服務模組 - 發票期次
// ============================================

/// 發票期次（用於批次結算）
/// 例如：2024年10月、2024年第一季
model InvoicingPeriod {
  id String @id @default(cuid())

  schoolId String
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  // 期次資料
  periodName   String // 例如："2024年10月"、"2024年Q1"
  academicYear String? // 學年（例如：2024-2025）
  periodType   String // MONTHLY | QUARTERLY | CUSTOM

  // 期次時間範圍
  periodStart DateTime
  periodEnd   DateTime

  // 期次狀態
  status InvoicingPeriodStatus @default(OPEN)

  // 結算資料（自動計算）
  totalLessons Int? // 該期間課堂總數
  totalRevenue Decimal? @db.Decimal(10, 2)
  totalExpense Decimal? @db.Decimal(10, 2)

  // 發票關聯
  invoices SchoolInvoice[]

  // 備註
  remarks String? @db.Text

  // 系統欄位
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@unique([schoolId, periodName])
  @@index([schoolId])
  @@index([status])
  @@index([periodStart, periodEnd])
  @@map("invoicing_periods")
}
