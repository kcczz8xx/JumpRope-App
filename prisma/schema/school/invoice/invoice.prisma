// ============================================
// 到校服務模組 - 發票
// ============================================

/// 到校發票
model SchoolInvoice {
  id String @id @default(cuid())

  schoolId String
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  // 關聯到發票期次
  periodId String?
  period   InvoicingPeriod? @relation(fields: [periodId], references: [id], onDelete: SetNull)

  // 發票編號
  invoiceNumber String  @unique
  invoiceToken  String? @unique

  // 發票類型
  invoiceType String?

  // 發票日期
  invoiceDate DateTime @default(now())

  // 付款條款
  paymentTermsDays Int       @default(30)
  dueDate          DateTime?

  // 發票狀態
  status InvoiceStatus @default(DRAFT)

  // 金額
  invoiceAmount Decimal @db.Decimal(10, 2)

  // 發送記錄
  sentDate DateTime?

  // 收件人資料
  salutation           String?
  recipientNameChinese String?
  recipientNameEnglish String?
  contactPosition      String?
  contactPhone         String?
  contactEmail         String?
  schoolPhone          String?
  schoolFax            String?
  mailingAddress       String? @db.Text

  // 備註
  invoiceRemarks String? @db.Text

  // 關聯
  items   SchoolInvoiceItem[] // 發票項目明細
  receipt SchoolReceipt?

  // 系統欄位
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([schoolId])
  @@index([periodId])
  @@index([status])
  @@index([invoiceNumber])
  @@index([invoiceDate])
  @@map("school_invoices")
}
