// ============================================
// 到校服務模組 - 課堂
// ============================================

/// 到校課堂
model SchoolLesson {
  id String @id @default(cuid())

  courseId String
  course   SchoolCourse @relation(fields: [courseId], references: [id], onDelete: Cascade)

  // 課堂基本資料
  lessonDate DateTime // 上課日期
  startTime  String // 開始時間（HH:mm 格式）
  endTime    String // 結束時間（HH:mm 格式）
  weekday    Int // 星期（1-7，1=Monday）

  // 課堂類型
  lessonType LessonType  @default(REGULAR) // 恆常/補堂/加操
  lessonTerm CourseTerm? // 所屬學期（若課程分學期）

  // 學生資料
  studentCount Int? // 實際學生人數

  // 課堂狀態
  lessonStatus LessonStatus @default(SCHEDULED)

  // 收費資料（用於生成 Invoice）
  feeMode    String? // 收費模式（關聯到 Course 的 chargingModel）
  feePerMode Decimal? @db.Decimal(10, 2) // 單價
  feeLesson  Decimal? @db.Decimal(10, 2) // 本課堂收費金額

  // 發票狀態（此課堂是否已納入發票）
  invoiceStatus String?        @default("NOT_INVOICED") // 發票狀態（未開立/已開立/已付款）
  invoiceId     String? // 關聯的發票 ID（可選）
  invoice       SchoolInvoice? @relation(fields: [invoiceId], references: [id])

  // 付款狀態
  paymentStatus PaymentStatus @default(PENDING)

  // 備註
  remarks String? @db.Text

  // 關聯
  tutorLessons SchoolTutorLesson[] // 導師任教記錄

  // 系統欄位
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([courseId])
  @@index([lessonDate])
  @@index([lessonStatus])
  @@index([invoiceStatus])
  @@index([invoiceId])
  @@map("school_lessons")
}
