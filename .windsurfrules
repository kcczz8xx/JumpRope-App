# é …ç›®æ¦‚è¿°

æœ¬é …ç›®ç‚º Next.js 15 App Router æ¶æ§‹çš„å…¨ç«¯ Web æ‡‰ç”¨ï¼Œæ¡ç”¨ **Feature-First + Colocation** æ¨¡å¼çµ„ç¹”ç¨‹å¼ç¢¼ã€‚å‰ç«¯é é¢èˆ‡å¾Œç«¯ API çš†åœ¨åŒä¸€å°ˆæ¡ˆå…§ç¶­è­·ï¼Œä¸¦æ•´åˆ Prisma èˆ‡è³‡æ–™åº«é€²è¡Œè³‡æ–™å­˜å–ã€‚

# å®‰è£ã€ç’°å¢ƒè®Šé‡ã€é‹è¡Œèˆ‡æ§‹å»º

## å®‰è£

- ä½¿ç”¨ `pnpm` ä½œç‚ºå¥—ä»¶ç®¡ç†å™¨ï¼ˆå·²æä¾› `pnpm-lock.yaml`ï¼‰
- å®‰è£ä¾è³´ï¼š`pnpm install`

## ç’°å¢ƒè®Šé‡

- è¤‡è£½ `.env.example` ç‚º `.env`
- è¨­å®šå¿…è¦ç’°å¢ƒè®Šé‡ï¼š
  - `DATABASE_URL` â€” è³‡æ–™åº«é€£ç·š URLï¼ˆæ”¯æ´ connection poolingï¼‰
  - `POSTGRES_URL_NON_POOLING` â€” ç›´é€£ URLï¼ˆç”¨æ–¼ migrationsï¼Œé¿å… dangling databasesï¼‰
  - `NEXT_PUBLIC_APP_URL`

## é–‹ç™¼/æ§‹å»º/å•Ÿå‹•

- `pnpm dev` â€” å•Ÿå‹•æœ¬åœ°é–‹ç™¼ä¼ºæœå™¨
- `pnpm build` â€” ç”¢ç”Ÿç”Ÿç”¢ç’°å¢ƒæ§‹å»º
- `pnpm start` â€” ä»¥æ§‹å»ºçµæœå•Ÿå‹•ç”Ÿç”¢ä¼ºæœå™¨
- `pnpm lint` â€” åŸ·è¡Œ ESLint
- `pnpm type-check` â€” åŸ·è¡Œ TypeScript é¡å‹æª¢æŸ¥ï¼ˆ`tsc -b`ï¼‰
- `pnpm test` â€” åŸ·è¡Œ Jest æ¸¬è©¦ï¼ˆå–®æ¬¡ï¼‰
- `pnpm test:watch` â€” Jest ç›£çœ‹æ¨¡å¼
- `pnpm test:coverage` â€” ç”¢ç”Ÿæ¸¬è©¦è¦†è“‹ç‡å ±å‘Š

## Prisma æŒ‡ä»¤

- `pnpm prisma:migrate <name>` â€” å»ºç«‹æ–° migration
- `pnpm prisma:deploy` â€” éƒ¨ç½² migrations + ç”¢ç”Ÿ Client
- `pnpm prisma:push` â€” ç›´æ¥æ¨é€ schema åˆ° DBï¼ˆprototyping ç”¨ï¼‰
- `pnpm prisma:studio` â€” é–‹å•Ÿ Prisma Studio GUI
- `pnpm prisma:seed` â€” åŸ·è¡Œ seed è…³æœ¬å¡«å……è³‡æ–™
- `pnpm prisma:wipe` â€” é‡ç½®è³‡æ–™åº«ï¼ˆâš ï¸ æœƒåˆªé™¤æ‰€æœ‰è³‡æ–™ï¼‰

# ç›®éŒ„çµæ§‹ï¼ˆFeature-First + src/ï¼‰

æ¡ç”¨ **Feature-First + Colocation** æ¨¡å¼ï¼Œå°‡åŸå§‹ç¢¼èˆ‡è¨­å®šæª”åˆ†é›¢ï¼š

```
jumprope-app/
â”œâ”€â”€ prisma/                 # âš ï¸ å¿…é ˆåœ¨æ ¹ç›®éŒ„ï¼ˆPrisma CLI é è¨­ä½ç½®ï¼‰
â”œâ”€â”€ public/                 # âš ï¸ å¿…é ˆåœ¨æ ¹ç›®éŒ„ï¼ˆNext.js éœæ…‹è³‡æºï¼‰
â”œâ”€â”€ docs/                   # å°ˆæ¡ˆæ–‡ä»¶
â”œâ”€â”€ scripts/                # è¼”åŠ©è…³æœ¬
â”‚
â””â”€â”€ src/                    # åŸå§‹ç¢¼ç›®éŒ„
    â”œâ”€â”€ app/                # Next.js App Router
    â”‚   â”œâ”€â”€ (public)/       # å…¬é–‹è·¯ç”±ç¾¤çµ„
    â”‚   â”œâ”€â”€ (private)/      # éœ€é©—è­‰è·¯ç”±ç¾¤çµ„
    â”‚   â”‚   â””â”€â”€ dashboard/
    â”‚   â”‚       â””â”€â”€ _components/  # è·¯ç”±å°ˆå±¬å…ƒä»¶ï¼ˆ_ å‰ç¶´é¿å…æˆç‚ºè·¯ç”±ï¼‰
    â”‚   â””â”€â”€ api/            # API Route Handlers
    â”‚
    â”œâ”€â”€ features/           # ğŸ¯ åŠŸèƒ½æ¨¡çµ„ï¼ˆæ ¸å¿ƒï¼‰
    â”‚   â”œâ”€â”€ auth/           # èªè­‰æ¨¡çµ„
    â”‚   â”œâ”€â”€ user/           # ç”¨æˆ¶æ¨¡çµ„
    â”‚   â”œâ”€â”€ school-service/ # å­¸æ ¡æœå‹™æ¨¡çµ„
    â”‚   â””â”€â”€ [feature]/      # æ¯å€‹åŠŸèƒ½æ¨™æº–çµæ§‹ â†“
    â”‚       â”œâ”€â”€ components/ # è©²åŠŸèƒ½å°ˆç”¨ UI å…ƒä»¶
    â”‚       â”œâ”€â”€ hooks/      # è©²åŠŸèƒ½å°ˆç”¨ Hooks
    â”‚       â”œâ”€â”€ actions.ts  # Server Actions
    â”‚       â”œâ”€â”€ queries.ts  # è³‡æ–™æŸ¥è©¢å‡½å¼
    â”‚       â”œâ”€â”€ schema.ts   # Zod é©—è­‰è¦å‰‡
    â”‚       â”œâ”€â”€ types.ts    # TypeScript å‹åˆ¥
    â”‚       â””â”€â”€ index.ts    # å…¬é–‹ APIï¼ˆæ§åˆ¶ exportï¼‰
    â”‚
    â”œâ”€â”€ components/         # å…¨åŸŸå…±ç”¨å…ƒä»¶
    â”‚   â”œâ”€â”€ ui/             # åŸºç¤ UIï¼ˆButton, Input, Modalï¼‰
    â”‚   â”œâ”€â”€ layout/         # Layout å…ƒä»¶ï¼ˆSidebar, Headerï¼‰
    â”‚   â””â”€â”€ tailadmin/      # UI æ¨¡æ¿å…ƒä»¶
    â”‚
    â”œâ”€â”€ lib/                # å…¨åŸŸå·¥å…·èˆ‡è¨­å®š
    â”‚   â”œâ”€â”€ auth/           # NextAuth é…ç½®ï¼ˆoptions.ts, types.tsï¼‰
    â”‚   â”œâ”€â”€ db/             # Prisma å®¢æˆ¶ç«¯
    â”‚   â”œâ”€â”€ providers/      # Context Providers
    â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½å¼ï¼ˆcn, formatDate ç­‰ï¼‰
    â”‚   â”œâ”€â”€ validations/    # å…±ç”¨ Zod Schema
    â”‚   â””â”€â”€ rbac/           # æ¬Šé™æ§åˆ¶
    â”‚
    â”œâ”€â”€ hooks/              # å…¨åŸŸå…±ç”¨ Hooks
    â”œâ”€â”€ config/             # æ‡‰ç”¨é…ç½®ï¼ˆsidebar-nav ç­‰ï¼‰
    â””â”€â”€ icons/              # React åœ–æ¨™å…ƒä»¶
```

## å…ƒä»¶æ”¾ç½®åŸå‰‡

| é¡å‹ | ä½ç½® | ç¯„ä¾‹ |
|:-----|:-----|:-----|
| åŠŸèƒ½å°ˆå±¬å…ƒä»¶ | `src/features/[name]/components/` | `LoginForm`, `UserCard` |
| è·¯ç”±å°ˆå±¬å…ƒä»¶ | `src/app/[route]/_components/` | `DashboardStats` |
| å…¨åŸŸå…±ç”¨å…ƒä»¶ | `src/components/` | `Button`, `Sidebar` |

# æŠ€è¡“æ£§

- **æ¡†æ¶**ï¼šNext.js 15ï¼ˆApp Routerï¼‰
- **èªè¨€**ï¼šTypeScript 5ï¼ˆåš´æ ¼æ¨¡å¼ï¼‰
- **æ¨£å¼**ï¼šTailwind CSS v4ï¼ˆCSS-based é…ç½®ï¼‰
- **æ¸¬è©¦**ï¼šJest + Testing Libraryï¼ˆJSDOMï¼‰
- **è³‡æ–™å±¤**ï¼šPrisma ORM
- **Lint**ï¼šESLintï¼ˆ`eslint-config-next`ï¼‰

# Feature-First é–‹ç™¼è¦ç¯„

## Feature æ¨™æº–çµæ§‹

æ¯å€‹åŠŸèƒ½æ¨¡çµ„å¿…é ˆåŒ…å« `index.ts` ä½œç‚ºå…¬é–‹ APIï¼š

```typescript
// src/features/auth/index.ts
export { LoginForm } from "./components/LoginForm";
export { RegisterForm } from "./components/RegisterForm";
export { loginAction, registerAction } from "./actions";
export { loginSchema, registerSchema } from "./schema";
export type { LoginInput, RegisterInput } from "./types";
```

## Import è¦å‰‡

```typescript
// âœ… æ­£ç¢ºï¼šé€éåŠŸèƒ½çš„å…¬é–‹ API import
import { LoginForm, loginAction } from "@/features/auth";

// âŒ éŒ¯èª¤ï¼šç›´æ¥ import åŠŸèƒ½å…§éƒ¨æª”æ¡ˆ
import { LoginForm } from "@/features/auth/components/LoginForm";

// âœ… åŠŸèƒ½å…§éƒ¨å¯ç”¨ç›¸å°è·¯å¾‘
// src/features/auth/components/LoginForm.tsx
import { loginAction } from "../actions";
import { loginSchema } from "../schema";
```

## Server Actions è¦ç¯„

```typescript
// src/features/auth/actions.ts
"use server";

import { revalidatePath } from "next/cache";
import { z } from "zod";
import { loginSchema } from "./schema";

export async function loginAction(input: z.infer<typeof loginSchema>) {
  // 1. é©—è­‰è¼¸å…¥ï¼ˆå¿…é ˆï¼‰
  const validated = loginSchema.parse(input);
  
  // 2. åŸ·è¡Œæ¥­å‹™é‚è¼¯
  // ...
  
  // 3. é‡æ–°é©—è­‰è·¯ç”±ï¼ˆå¦‚éœ€è¦ï¼‰
  revalidatePath("/dashboard");
  
  // 4. è¿”å›çµæœ
  return { success: true };
}
```

## ä¾è³´æµå‘ï¼ˆå–®å‘ï¼‰

```
app/ â†’ features/ â†’ lib/
       â†“
       components/ui/
```

- `features/` å¯ä»¥ import `lib/` å’Œ `components/ui/`
- `features/` ä¹‹é–“**ä¸æ‡‰**äº’ç›¸ import
- å¦‚éœ€å…±ç”¨é‚è¼¯ï¼Œæå–åˆ° `lib/`

# Next.js 15 æœ€ä½³å¯¦è¸

## Server Components vs Client Components

- **é è¨­ä½¿ç”¨ Server Components** â€” æ¸›å°‘ client bundleã€ç›´æ¥å­˜å–è³‡æ–™åº«
- **åªåœ¨å¿…è¦æ™‚åŠ  `"use client"`** â€” éœ€è¦ interactivityã€hooksã€browser APIs æ™‚
- **Client Components æ”¾åœ¨çµ„ä»¶æ¨¹è‘‰ç«¯** â€” æœ€å°åŒ– client JS

```tsx
// âœ… Server Componentï¼ˆé è¨­ï¼‰
async function UserProfile({ userId }: { userId: string }) {
  const user = await prisma.user.findUnique({ where: { id: userId } });
  return <div>{user?.name}</div>;
}

// âœ… Client Componentï¼ˆéœ€è¦äº’å‹•ï¼‰
"use client";
function LikeButton() {
  const [liked, setLiked] = useState(false);
  return <button onClick={() => setLiked(!liked)}>Like</button>;
}
```

## è³‡æ–™ç²å–æ¨¡å¼

- **Server Components ç›´æ¥ `await`** â€” ç„¡éœ€ `useEffect`
- **ä½¿ç”¨ SWR è™•ç† Client-side è³‡æ–™** â€” å·²é…ç½®æ–¼ `lib/client/swr-config.ts`
- **å„ªå…ˆ Server Actions** â€” å–ä»£å‚³çµ± API Routes è™•ç†è¡¨å–®æäº¤

## éŒ¯èª¤è™•ç†

- **ä½¿ç”¨ `error.tsx`** â€” æ¯å€‹è·¯ç”±æ®µçš„éŒ¯èª¤é‚Šç•Œ
- **ä½¿ç”¨ `loading.tsx`** â€” Suspense è¼‰å…¥ç‹€æ…‹
- **ä½¿ç”¨ `not-found.tsx`** â€” 404 è™•ç†

## æ€§èƒ½å„ªåŒ–

- **å‹•æ…‹å°å…¥** â€” `next/dynamic` å»¶é²è¼‰å…¥å¤§å‹çµ„ä»¶
- **Image å„ªåŒ–** â€” ä½¿ç”¨ `next/image`
- **å­—é«”å„ªåŒ–** â€” ä½¿ç”¨ `next/font`
- **Metadata API** â€” ä½¿ç”¨ `generateMetadata` è™•ç† SEO

# ä»£ç¢¼è¦ç¯„

- **æ ¼å¼**ï¼š2 ç©ºæ ¼ç¸®æ’ã€å–®å¼•è™Ÿã€åˆ†è™Ÿ
- **è·¯å¾‘**ï¼šä½¿ç”¨ `@/` æŒ‡å‘ `src/`
- **å‘½å**ï¼š
  - React å…ƒä»¶ï¼šPascalCaseï¼ˆ`UserCard.tsx`ï¼‰
  - å‡½å¼/è®Šæ•¸ï¼šcamelCase
  - å¸¸æ•¸ï¼šUPPER_SNAKE_CASE
- **Import æ’åº**ï¼šä½¿ç”¨ `eslint-plugin-simple-import-sort`
- **æ¸¬è©¦**ï¼šæ”¾åœ¨åŒç›®éŒ„ `__tests__/` æˆ–å‘½åç‚º `*.test.ts(x)`

## æ¸¬è©¦è¦ç¯„

- **æ¸¬è©¦æª”èˆ‡å¯¦ä½œæª”æ”¾ä¸€èµ·**ï¼ˆGroup by Featureï¼‰
- **ä½¿ç”¨ AAA æ¨¡å¼**ï¼šArrange â†’ Act â†’ Assert
- **å‘½åæ ¼å¼**ï¼š`given [context]: [expected behavior]`

```ts
describe("UserCard", () => {
  test("given a user with name: renders the name", () => {
    render(<UserCard user={{ name: "Alice" }} />);
    expect(screen.getByText("Alice")).toBeInTheDocument();
  });
});
```

# å®‰å…¨æ€§è¦ç¯„

- âœ… Server Actions å¿…é ˆåŠ  `"use server"` æ¨™è¨˜
- âœ… æ‰€æœ‰ user input å¿…é ˆé€šé Zod é©—è­‰
- âœ… ä¸è¦åœ¨ Client Components æš´éœ²æ•æ„Ÿé‚è¼¯
- âœ… ä½¿ç”¨ NextAuth çš„ `auth()` æª¢æŸ¥æ¬Šé™

# æäº¤æµç¨‹

- **Commit**ï¼šConventional Commitsï¼ˆ`feat:`, `fix:`, `docs:`, `chore:`, `refactor:`ï¼‰
- **PR**ï¼šéœ€åŒ…å«æ‘˜è¦ã€é—œè¯è­°é¡Œï¼ˆè‹¥æœ‰ï¼‰ã€UI æˆªåœ–ã€æ¸¬è©¦çµæœ

# CI/CD æª¢æŸ¥æ¸…å–®

PR åˆä½µå‰éœ€é€šéï¼š
1. `pnpm lint` â€” ESLint æª¢æŸ¥
2. `pnpm type-check` â€” TypeScript é¡å‹æª¢æŸ¥
3. `pnpm test` â€” å–®å…ƒæ¸¬è©¦
4. `pnpm build` â€” æ§‹å»ºæˆåŠŸ

# å¸¸è¦‹éŒ¯èª¤é€ŸæŸ¥

| éŒ¯èª¤è¨Šæ¯ | è§£æ±ºæ–¹æ¡ˆ |
|:---------|:---------|
| `Module not found: '@/utils'` | æ”¹ç‚º `@/lib/utils` |
| `Cannot find module '@/layout'` | æ”¹ç‚º `@/components/layout` |
| `Cannot find module '@/context'` | æ”¹ç‚º `@/lib/providers` |
| Tailwind æ¨£å¼å¤±æ•ˆ | æª¢æŸ¥ `tsconfig.json` çš„ `include` æ˜¯å¦æ¶µè“‹ `src/` |
| Prisma æ‰¾ä¸åˆ° schema | ç¢ºèª `prisma/` åœ¨æ ¹ç›®éŒ„ |
