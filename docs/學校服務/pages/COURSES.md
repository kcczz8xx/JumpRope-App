# ğŸ“š èª²ç¨‹åˆ—è¡¨ - Courses

> **è·¯å¾‘**: `/dashboard/school/courses`  
> **å„ªå…ˆç´š**: P0  
> **è§’è‰²**: ADMIN (CRUD), SCHOOL_ADMIN (å”¯è®€), TUTOR (å”¯è®€ä»»æ•™èª²ç¨‹)

---

## ğŸ“‹ é é¢æ¦‚è¿°

èª²ç¨‹ç®¡ç†åˆ—è¡¨é ï¼Œä»¥å¡ç‰‡å½¢å¼é¡¯ç¤ºèª²ç¨‹ï¼ŒåŒ…å«é€²åº¦æ¢å’ŒåŸºæœ¬çµ±è¨ˆã€‚æ”¯æ´ç¯©é¸å’Œæœå°‹ã€‚

---

## ğŸ¨ é é¢çµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š èª²ç¨‹ç®¡ç†                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å­¸å¹´: [2024-2025â–¼]  ç‹€æ…‹: [æ´»èºâ–¼]   [â• æ–°å¢èª²ç¨‹]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ ğŸ“š å°å­¸èŠ±å¼è·³ç¹© â”‚ â”‚ ğŸƒ é€Ÿåº¦è·³è¨“ç·´   â”‚ â”‚ ğŸ¯ æ¯”è³½åŸ¹è¨“ç­  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  â”‚ ğŸ“ è–ä¿ç¾…å°å­¸   â”‚ â”‚ ğŸ“ åŸ¹æ­£ä¸­å­¸     â”‚ â”‚ ğŸ“ å”æ©ä¸­å­¸    â”‚
â”‚  â”‚ ğŸ“… 2024-25 ä¸Š   â”‚ â”‚ ğŸ“… 2024-25 ä¸Š   â”‚ â”‚ ğŸ“… 2024-25 å…¨å¹´â”‚
â”‚  â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚  â”‚ ğŸ‘¥ å°å¸« 2äºº     â”‚ â”‚ ğŸ‘¥ å°å¸« 1äºº     â”‚ â”‚ ğŸ‘¥ å°å¸« 3äºº    â”‚
â”‚  â”‚ ğŸ’° å­¸ç”Ÿ$50/å ‚   â”‚ â”‚ ğŸ’° å›ºå®š$800/å ‚  â”‚ â”‚ ğŸ’° å­¸ç”Ÿ$60/å ‚  â”‚
â”‚  â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚  â”‚ é€²åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 8/24â”‚ â”‚ é€²åº¦: â–ˆâ–ˆâ–‘â–‘â–‘â–‘ 4/12â”‚ â”‚ é€²åº¦: â–ˆâ–‘â–‘â–‘â–‘â–‘ 2/20â”‚
â”‚  â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚  â”‚ ğŸŸ¢ æ´»èº         â”‚ â”‚ ğŸŸ¢ æ´»èº         â”‚ â”‚ ğŸŸ¢ æ´»èº        â”‚
â”‚  â”‚ [æŸ¥çœ‹] [æ’èª²]   â”‚ â”‚ [æŸ¥çœ‹] [æ’èª²]   â”‚ â”‚ [æŸ¥çœ‹] [æ’èª²]  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                             â”‚
â”‚  é¡¯ç¤º 1-9 / å…± 18 å€‹èª²ç¨‹                    [<] 1 2 [>]    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© ä½¿ç”¨çµ„ä»¶

### TailAdmin çµ„ä»¶

| çµ„ä»¶             | è·¯å¾‘                                | ç”¨é€”         |
| ---------------- | ----------------------------------- | ------------ |
| `HorizontalCard` | `components/cards/horizontal-card/` | èª²ç¨‹å¡ç‰‡åƒè€ƒ |
| `Badge`          | `components/ui/badge/Badge.tsx`     | ç‹€æ…‹æ¨™ç±¤     |
| `Select`         | `components/form/Select.tsx`        | ç¯©é¸ä¸‹æ‹‰     |
| `Pagination`     | `components/ui/pagination/`         | åˆ†é          |

### éœ€é–‹ç™¼çµ„ä»¶

| çµ„ä»¶                | èªªæ˜                 |
| ------------------- | -------------------- |
| `CourseCard`        | èª²ç¨‹å¡ç‰‡ï¼ˆå«é€²åº¦æ¢ï¼‰ |
| `CourseStatusBadge` | èª²ç¨‹ç‹€æ…‹æ¨™ç±¤         |
| `ProgressBar`       | èª²å ‚é€²åº¦æ¢           |

---

## ğŸ“Š è³‡æ–™çµæ§‹

### èª²ç¨‹å¡ç‰‡è³‡æ–™

```typescript
interface CourseCardData {
  id: string;
  courseName: string;
  courseType: CourseType;
  courseTerm: CourseTerm;
  academicYear: string;

  school: {
    id: string;
    schoolName: string;
  };

  requiredTutors: number;
  maxStudents?: number;

  chargingModel: ChargingModel;
  studentPerLessonFee?: number;
  fixedPerLessonFee?: number;

  status: CourseStatus;

  // çµ±è¨ˆè³‡æ–™
  stats: {
    totalLessons: number;
    completedLessons: number;
    assignedTutors: number;
  };
}
```

### æŸ¥è©¢åƒæ•¸

```typescript
interface CourseListParams {
  academicYear?: string;
  status?: CourseStatus | "all";
  schoolId?: string; // SCHOOL_ADMIN/TUTOR éæ¿¾
  tutorId?: string; // TUTOR éæ¿¾
  page?: number;
  pageSize?: number;
}
```

### API æŸ¥è©¢

```typescript
// API: GET /api/courses
async function getCourses(params: CourseListParams, session: Session) {
  const { academicYear, status, page = 1, pageSize = 9 } = params;

  let where: Prisma.SchoolCourseWhereInput = {
    deletedAt: null,
    ...(academicYear && { academicYear }),
    ...(status && status !== "all" && { status }),
  };

  // è§’è‰²éæ¿¾
  if (session.user.role === "SCHOOL_ADMIN") {
    where.schoolId = session.user.schoolId;
  } else if (session.user.role === "TUTOR") {
    where.lessons = {
      some: {
        tutorLessons: {
          some: { userId: session.user.id },
        },
      },
    };
  }

  const [courses, total] = await Promise.all([
    prisma.schoolCourse.findMany({
      where,
      include: {
        school: { select: { id: true, schoolName: true } },
        lessons: {
          select: {
            id: true,
            lessonStatus: true,
          },
        },
        _count: {
          select: {
            lessons: true,
          },
        },
      },
      orderBy: { startDate: "desc" },
      skip: (page - 1) * pageSize,
      take: pageSize,
    }),
    prisma.schoolCourse.count({ where }),
  ]);

  // è¨ˆç®—çµ±è¨ˆ
  const coursesWithStats = courses.map((course) => ({
    ...course,
    stats: {
      totalLessons: course._count.lessons,
      completedLessons: course.lessons.filter(
        (l) => l.lessonStatus === "COMPLETED"
      ).length,
      assignedTutors: new Set(
        course.lessons.flatMap(
          (l) => l.tutorLessons?.map((tl) => tl.userId) || []
        )
      ).size,
    },
  }));

  return {
    data: coursesWithStats,
    pagination: {
      page,
      pageSize,
      total,
      totalPages: Math.ceil(total / pageSize),
    },
  };
}
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. èª²ç¨‹å¡ç‰‡

```tsx
// components/school-service/course/CourseCard.tsx
interface CourseCardProps {
  course: CourseCardData;
  onView?: () => void;
  onSchedule?: () => void;
  isAdmin?: boolean;
}

export function CourseCard({
  course,
  onView,
  onSchedule,
  isAdmin,
}: CourseCardProps) {
  const progress =
    course.stats.totalLessons > 0
      ? (course.stats.completedLessons / course.stats.totalLessons) * 100
      : 0;

  const getChargingDisplay = () => {
    switch (course.chargingModel) {
      case "STUDENT_PER_LESSON":
        return `å­¸ç”Ÿ $${course.studentPerLessonFee}/å ‚`;
      case "FIXED_PER_LESSON":
        return `å›ºå®š $${course.fixedPerLessonFee}/å ‚`;
      default:
        return "-";
    }
  };

  return (
    <div className="rounded-xl border border-gray-200 bg-white p-5 hover:shadow-md transition-shadow dark:border-gray-800 dark:bg-gray-900">
      {/* æ¨™é¡Œ */}
      <div className="flex items-start justify-between mb-3">
        <h3 className="font-semibold text-lg line-clamp-1">
          {course.courseName}
        </h3>
        <CourseStatusBadge status={course.status} />
      </div>

      {/* å­¸æ ¡ */}
      <div className="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2">
        <MapPinIcon className="h-4 w-4" />
        <span>{course.school.schoolName}</span>
      </div>

      {/* å­¸æœŸ */}
      <div className="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-4">
        <CalendarIcon className="h-4 w-4" />
        <span>
          {course.academicYear} {courseTermLabels[course.courseTerm]}
        </span>
      </div>

      {/* çµ±è¨ˆ */}
      <div className="flex items-center gap-4 text-sm mb-4">
        <div className="flex items-center gap-1">
          <UsersIcon className="h-4 w-4 text-gray-400" />
          <span>
            å°å¸« {course.stats.assignedTutors}/{course.requiredTutors} äºº
          </span>
        </div>
        <div className="flex items-center gap-1">
          <DollarIcon className="h-4 w-4 text-gray-400" />
          <span>{getChargingDisplay()}</span>
        </div>
      </div>

      {/* é€²åº¦æ¢ */}
      <div className="mb-4">
        <div className="flex items-center justify-between text-sm mb-1">
          <span className="text-gray-500">èª²å ‚é€²åº¦</span>
          <span className="font-medium">
            {course.stats.completedLessons}/{course.stats.totalLessons}
          </span>
        </div>
        <div className="h-2 bg-gray-200 rounded-full dark:bg-gray-700">
          <div
            className="h-2 bg-primary-500 rounded-full transition-all"
            style={{ width: `${progress}%` }}
          />
        </div>
      </div>

      {/* æ“ä½œæŒ‰éˆ• */}
      <div className="flex gap-2">
        <Button variant="outline" size="sm" className="flex-1" onClick={onView}>
          æŸ¥çœ‹è©³æƒ…
        </Button>
        {isAdmin && (
          <Button
            variant="primary"
            size="sm"
            className="flex-1"
            onClick={onSchedule}
          >
            æ’èª²
          </Button>
        )}
      </div>
    </div>
  );
}
```

### 2. èª²ç¨‹ç‹€æ…‹æ¨™ç±¤

```tsx
function CourseStatusBadge({ status }: { status: CourseStatus }) {
  const config: Record<CourseStatus, { color: string; text: string }> = {
    DRAFT: { color: "gray", text: "è‰ç¨¿" },
    ACTIVE: { color: "green", text: "æ´»èº" },
    COMPLETED: { color: "blue", text: "å·²å®Œæˆ" },
    CANCELLED: { color: "red", text: "å·²å–æ¶ˆ" },
  };

  const { color, text } = config[status];

  return (
    <Badge variant="light" color={color}>
      {text}
    </Badge>
  );
}
```

### 3. å­¸å¹´é¸é …

```typescript
function generateAcademicYearOptions(): { value: string; label: string }[] {
  const currentYear = new Date().getFullYear();
  const options = [];

  // å¾€å‰ 2 å¹´ï¼Œå¾€å¾Œ 1 å¹´
  for (let i = -2; i <= 1; i++) {
    const year = currentYear + i;
    options.push({
      value: `${year}-${year + 1}`,
      label: `${year}-${year + 1}`,
    });
  }

  return options;
}
```

---

## ğŸ’» ç¨‹å¼ç¢¼ç¯„ä¾‹

### é é¢çµæ§‹

```tsx
// app/(private)/dashboard/school/courses/page.tsx
"use client";

import { useState } from "react";
import { useSession } from "next-auth/react";
import { useRouter } from "next/navigation";
import useSWR from "swr";
import Link from "next/link";
import { PageBreadCrumb } from "@/components/common/PageBreadCrumb";
import { CourseCard } from "./components/CourseCard";
import { Pagination } from "@/components/ui/pagination";

export default function CoursesPage() {
  const { data: session } = useSession();
  const router = useRouter();

  const currentYear = new Date().getFullYear();
  const defaultAcademicYear = `${currentYear}-${currentYear + 1}`;

  const [academicYear, setAcademicYear] = useState(defaultAcademicYear);
  const [status, setStatus] = useState<string>("ACTIVE");
  const [page, setPage] = useState(1);

  const isAdmin = session?.user?.role === "ADMIN";

  const queryString = new URLSearchParams({
    academicYear,
    ...(status !== "all" && { status }),
    page: page.toString(),
  }).toString();

  const { data, isLoading } = useSWR(`/api/courses?${queryString}`, fetcher);

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <PageBreadCrumb title="èª²ç¨‹ç®¡ç†" />

        {isAdmin && (
          <Link href="/dashboard/school/courses/new">
            <Button variant="primary">
              <PlusIcon className="h-4 w-4 mr-2" />
              æ–°å¢èª²ç¨‹
            </Button>
          </Link>
        )}
      </div>

      {/* ç¯©é¸å™¨ */}
      <div className="flex flex-wrap gap-4">
        <Select
          value={academicYear}
          onChange={setAcademicYear}
          options={generateAcademicYearOptions()}
          className="w-40"
        />

        <Select
          value={status}
          onChange={(v) => {
            setStatus(v);
            setPage(1);
          }}
          options={[
            { value: "all", label: "å…¨éƒ¨ç‹€æ…‹" },
            { value: "ACTIVE", label: "æ´»èº" },
            { value: "COMPLETED", label: "å·²å®Œæˆ" },
            { value: "DRAFT", label: "è‰ç¨¿" },
            { value: "CANCELLED", label: "å·²å–æ¶ˆ" },
          ]}
          className="w-32"
        />
      </div>

      {/* èª²ç¨‹å¡ç‰‡ç¶²æ ¼ */}
      {isLoading ? (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {[1, 2, 3].map((i) => (
            <div
              key={i}
              className="h-64 rounded-xl bg-gray-100 animate-pulse dark:bg-gray-800"
            />
          ))}
        </div>
      ) : data?.data.length === 0 ? (
        <div className="text-center py-12 text-gray-500">æ²’æœ‰èª²ç¨‹è¨˜éŒ„</div>
      ) : (
        <>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {data?.data.map((course: CourseCardData) => (
              <CourseCard
                key={course.id}
                course={course}
                isAdmin={isAdmin}
                onView={() =>
                  router.push(`/dashboard/school/courses/${course.id}`)
                }
                onSchedule={() =>
                  router.push(
                    `/dashboard/school/courses/${course.id}?tab=schedule`
                  )
                }
              />
            ))}
          </div>

          {/* åˆ†é  */}
          {data?.pagination && (
            <div className="flex items-center justify-between">
              <span className="text-sm text-gray-500">
                é¡¯ç¤º {(data.pagination.page - 1) * data.pagination.pageSize + 1}
                -
                {Math.min(
                  data.pagination.page * data.pagination.pageSize,
                  data.pagination.total
                )}{" "}
                / å…± {data.pagination.total} å€‹èª²ç¨‹
              </span>
              <Pagination
                currentPage={data.pagination.page}
                totalPages={data.pagination.totalPages}
                onPageChange={setPage}
              />
            </div>
          )}
        </>
      )}
    </div>
  );
}
```

---

## ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆ

| æ–·é»                    | å¡ç‰‡åˆ—æ•¸ |
| ----------------------- | -------- |
| mobile (< 768px)        | 1 åˆ—     |
| tablet (768px - 1024px) | 2 åˆ—     |
| desktop (> 1024px)      | 3 åˆ—     |

---

## âœ… é©—æ”¶æ¨™æº–

- [ ] ADMIN å¯æŸ¥çœ‹æ‰€æœ‰èª²ç¨‹
- [ ] SCHOOL_ADMIN åªèƒ½æŸ¥çœ‹è‡ªå·±å­¸æ ¡çš„èª²ç¨‹
- [ ] TUTOR åªèƒ½æŸ¥çœ‹è‡ªå·±ä»»æ•™çš„èª²ç¨‹
- [ ] å­¸å¹´ç¯©é¸æ­£ç¢ºé‹ä½œ
- [ ] ç‹€æ…‹ç¯©é¸æ­£ç¢ºé‹ä½œ
- [ ] é€²åº¦æ¢é¡¯ç¤ºæ­£ç¢ºæ¯”ä¾‹
- [ ] é»æ“Šå¡ç‰‡è·³è½‰åˆ°è©³æƒ…é 
- [ ] ADMIN å¯æ–°å¢èª²ç¨‹
- [ ] éŸ¿æ‡‰å¼å¡ç‰‡ç¶²æ ¼æ­£å¸¸é‹ä½œ
