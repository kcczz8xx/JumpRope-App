# ğŸ“ èª²ç¨‹è©³æƒ… + æ’èª² - Courses Detail

> **è·¯å¾‘**: `/dashboard/school/courses/[id]`  
> **å„ªå…ˆç´š**: P0  
> **è§’è‰²**: ADMIN (ç·¨è¼¯), SCHOOL_ADMIN/TUTOR (å”¯è®€)

---

## ğŸ“‹ é é¢æ¦‚è¿°

èª²ç¨‹è©³æƒ…é æ˜¯**æ’èª²ä¸­æ¨**ï¼Œé¡¯ç¤ºèª²ç¨‹è³‡æ–™ã€èª²å ‚åˆ—è¡¨ã€æ—¥æ›†è¦–åœ–ï¼Œæ”¯æ´æ‰¹æ¬¡ç”Ÿæˆèª²å ‚å’Œæ‰‹å‹•æ–°å¢èª²å ‚ã€‚

---

## ğŸ¨ é é¢çµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š å°å­¸èŠ±å¼è·³ç¹©åˆç­                           [ç·¨è¼¯] [åˆªé™¤] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“ è–ä¿ç¾…å°å­¸ | ğŸ“… 2024-2025 ä¸Šå­¸æœŸ                  â”‚   â”‚
â”‚  â”‚ ğŸ‘¥ å°å¸« 2 äºº | ğŸ’° å­¸ç”Ÿæ¯å ‚ $50 | å°å¸«æ¯å ‚ $300      â”‚   â”‚
â”‚  â”‚ ğŸ“† 2024-09-09 ~ 2025-01-17                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [ ğŸ“… æ—¥æ›†è¦–åœ– ] [ ğŸ“‹ åˆ—è¡¨è¦–åœ– ] [ ğŸ“Š çµ±è¨ˆ ]        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“… 2024 å¹´ 11 æœˆ         â”‚ â”‚ èª²å ‚åˆ—è¡¨               â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚æ—¥â”‚ä¸€â”‚äºŒâ”‚ä¸‰â”‚å››â”‚äº”â”‚å…­â”‚ â”‚ â”‚ â”‚ #1 09/09 14:00     â”‚ â”‚   â”‚
â”‚  â”‚ â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤ â”‚ â”‚ â”‚ å¼µæ•™ç·´ âœ… å·²å®Œæˆ    â”‚ â”‚   â”‚
â”‚  â”‚ â”‚  â”‚  â”‚  â”‚  â”‚1 â”‚2 â”‚3 â”‚ â”‚ â”‚ â”‚ å­¸ç”Ÿ 20 äºº         â”‚ â”‚   â”‚
â”‚  â”‚ â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚ â”‚4 â”‚ğŸŸ¢â”‚6 â”‚7 â”‚8 â”‚9 â”‚10â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚  â”‚14â”‚  â”‚  â”‚  â”‚  â”‚  â”‚ â”‚ â”‚ â”‚ #2 09/16 14:00     â”‚ â”‚   â”‚
â”‚  â”‚ â”‚  â”‚:00â”‚  â”‚  â”‚  â”‚  â”‚  â”‚ â”‚ â”‚ â”‚ å¼µæ•™ç·´ âœ… å·²å®Œæˆ    â”‚ â”‚   â”‚
â”‚  â”‚ â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚ â”‚11â”‚ğŸŸ¢â”‚13â”‚14â”‚15â”‚16â”‚17â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚  â”‚14â”‚  â”‚  â”‚  â”‚  â”‚  â”‚ â”‚ â”‚ â”‚ #3 09/23 14:00     â”‚ â”‚   â”‚
â”‚  â”‚ â”‚  â”‚:00â”‚  â”‚  â”‚  â”‚  â”‚  â”‚ â”‚ â”‚ â”‚ âš ï¸ æœªåˆ†é…å°å¸«      â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                        â”‚ â”‚                         â”‚   â”‚
â”‚  â”‚ [æ‰¹æ¬¡ç”Ÿæˆ] [æ–°å¢å–®å ‚]  â”‚ â”‚ é¡¯ç¤º 1-10 / å…± 24 å ‚   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“Š èª²ç¨‹çµ±è¨ˆ                                          â”‚   â”‚
â”‚  â”‚ â”œâ”€ å·²å®Œæˆèª²å ‚ï¼š8 å ‚                                  â”‚   â”‚
â”‚  â”‚ â”œâ”€ å·²é–‹ç¥¨èª²å ‚ï¼š8 å ‚                                  â”‚   â”‚
â”‚  â”‚ â”œâ”€ å¾…é–‹ç¥¨èª²å ‚ï¼š0 å ‚                                  â”‚   â”‚
â”‚  â”‚ â””â”€ ç´¯è¨ˆæ”¶å…¥ï¼šHK$ 8,000                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© ä½¿ç”¨çµ„ä»¶

### TailAdmin çµ„ä»¶

| çµ„ä»¶            | è·¯å¾‘                                  | ç”¨é€”     |
| --------------- | ------------------------------------- | -------- |
| `Calendar`      | `components/calendar/Calendar.tsx`    | æ—¥æ›†è¦–åœ– |
| `Tabs`          | `components/ui/tabs/`                 | è¦–åœ–åˆ‡æ› |
| `Modal`         | `components/ui/modal/`                | å½ˆçª—è¡¨å–® |
| `Badge`         | `components/ui/badge/Badge.tsx`       | ç‹€æ…‹æ¨™ç±¤ |
| `TableDropdown` | `components/common/TableDropdown.tsx` | èª²å ‚æ“ä½œ |

### éœ€é–‹ç™¼çµ„ä»¶

| çµ„ä»¶                   | èªªæ˜               |
| ---------------------- | ------------------ |
| `BatchLessonGenerator` | æ‰¹æ¬¡ç”Ÿæˆèª²å ‚ Modal |
| `LessonCard`           | èª²å ‚å¡ç‰‡           |
| `LessonCalendarView`   | èª²å ‚æ—¥æ›†è¦–åœ–       |
| `TutorAssignModal`     | å°å¸«åˆ†é… Modal     |

---

## ğŸ“Š è³‡æ–™çµæ§‹

### èª²ç¨‹è©³æƒ…

```typescript
interface CourseDetail {
  id: string;
  courseName: string;
  courseType: CourseType;
  courseTerm: CourseTerm;
  academicYear: string;
  startDate: Date;
  endDate?: Date;

  school: {
    id: string;
    schoolName: string;
  };

  requiredTutors: number;
  maxStudents?: number;

  chargingModel: ChargingModel;
  studentPerLessonFee?: number;
  tutorPerLessonFee?: number;

  status: CourseStatus;

  lessons: LessonWithTutors[];

  stats: {
    totalLessons: number;
    completedLessons: number;
    invoicedLessons: number;
    totalRevenue: number;
  };
}

interface LessonWithTutors {
  id: string;
  lessonDate: Date;
  startTime: string;
  endTime: string;
  lessonNumber?: number;
  lessonType: LessonType;
  lessonStatus: LessonStatus;
  studentCount?: number;
  feeLesson?: number;
  invoiceStatus: InvoiceStatus;

  tutors: {
    id: string;
    user: {
      id: string;
      name: string;
    };
    tutorRole: TutorRole;
    attendanceStatus: AttendanceStatus;
  }[];
}
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ‰¹æ¬¡ç”Ÿæˆèª²å ‚

```tsx
// components/school-service/course/BatchLessonGenerator.tsx
interface BatchGeneratorProps {
  courseId: string;
  courseStartDate: Date;
  courseEndDate?: Date;
  onGenerate: () => void;
  onClose: () => void;
}

interface GenerationRule {
  weekdays: number[]; // 1-7 (é€±ä¸€è‡³é€±æ—¥)
  startTime: string; // "14:00"
  endTime: string; // "15:30"
  startDate: Date;
  endDate: Date;
  excludeDates: Date[]; // æ’é™¤æ—¥æœŸ
}

export function BatchLessonGenerator({
  courseId,
  courseStartDate,
  courseEndDate,
  onGenerate,
  onClose,
}: BatchGeneratorProps) {
  const [rule, setRule] = useState<GenerationRule>({
    weekdays: [1], // é è¨­é€±ä¸€
    startTime: "14:00",
    endTime: "15:30",
    startDate: courseStartDate,
    endDate: courseEndDate || addMonths(courseStartDate, 4),
    excludeDates: [],
  });

  const [preview, setPreview] = useState<Date[]>([]);
  const [isSubmitting, setIsSubmitting] = useState(false);

  // é è¦½ç”Ÿæˆçµæœ
  useEffect(() => {
    const dates = generateLessonDates(rule);
    setPreview(dates);
  }, [rule]);

  const handleSubmit = async () => {
    setIsSubmitting(true);

    try {
      await fetch(`/api/courses/${courseId}/lessons/batch`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          rule,
          lessonDates: preview,
        }),
      });

      onGenerate();
      onClose();
    } catch (error) {
      console.error("ç”Ÿæˆå¤±æ•—:", error);
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <Modal isOpen onClose={onClose} className="max-w-lg">
      <div className="p-6">
        <h3 className="text-lg font-semibold mb-4">æ‰¹æ¬¡ç”Ÿæˆèª²å ‚</h3>

        {/* æ˜ŸæœŸé¸æ“‡ */}
        <div className="mb-4">
          <Label>ä¸Šèª²æ—¥ï¼ˆå¯å¤šé¸ï¼‰</Label>
          <div className="flex gap-2 mt-2">
            {["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "æ—¥"].map((day, index) => (
              <button
                key={index}
                onClick={() => {
                  const weekday = index + 1;
                  setRule((prev) => ({
                    ...prev,
                    weekdays: prev.weekdays.includes(weekday)
                      ? prev.weekdays.filter((w) => w !== weekday)
                      : [...prev.weekdays, weekday].sort(),
                  }));
                }}
                className={cn(
                  "w-10 h-10 rounded-full text-sm font-medium transition-colors",
                  rule.weekdays.includes(index + 1)
                    ? "bg-primary-500 text-white"
                    : "bg-gray-100 text-gray-600 hover:bg-gray-200"
                )}
              >
                {day}
              </button>
            ))}
          </div>
        </div>

        {/* æ™‚é–“è¨­å®š */}
        <div className="grid grid-cols-2 gap-4 mb-4">
          <div>
            <Label>é–‹å§‹æ™‚é–“</Label>
            <Input
              type="time"
              value={rule.startTime}
              onChange={(e) =>
                setRule((prev) => ({ ...prev, startTime: e.target.value }))
              }
            />
          </div>
          <div>
            <Label>çµæŸæ™‚é–“</Label>
            <Input
              type="time"
              value={rule.endTime}
              onChange={(e) =>
                setRule((prev) => ({ ...prev, endTime: e.target.value }))
              }
            />
          </div>
        </div>

        {/* æ—¥æœŸç¯„åœ */}
        <div className="grid grid-cols-2 gap-4 mb-4">
          <div>
            <Label>é–‹å§‹æ—¥æœŸ</Label>
            <DatePicker
              value={rule.startDate}
              onChange={(date) =>
                setRule((prev) => ({ ...prev, startDate: date }))
              }
            />
          </div>
          <div>
            <Label>çµæŸæ—¥æœŸ</Label>
            <DatePicker
              value={rule.endDate}
              onChange={(date) =>
                setRule((prev) => ({ ...prev, endDate: date }))
              }
            />
          </div>
        </div>

        {/* æ’é™¤æ—¥æœŸï¼ˆç°¡åŒ–ç‰ˆï¼Œå¯æ“´å±•ç‚ºæ—¥æ›†é¸æ“‡ï¼‰ */}
        <div className="mb-4">
          <Label>æ’é™¤æ—¥æœŸï¼ˆå‡æœŸï¼‰</Label>
          <p className="text-sm text-gray-500 mt-1">
            å¯åœ¨ç”Ÿæˆå¾Œæ‰‹å‹•åˆªé™¤ä¸éœ€è¦çš„èª²å ‚
          </p>
        </div>

        {/* é è¦½ */}
        <div className="mb-6 p-4 bg-gray-50 rounded-lg dark:bg-gray-800">
          <div className="flex items-center justify-between mb-2">
            <span className="font-medium">é è¦½</span>
            <span className="text-primary-600 font-semibold">
              å°‡ç”Ÿæˆ {preview.length} å€‹èª²å ‚
            </span>
          </div>

          {preview.length > 0 && (
            <div className="text-sm text-gray-500">
              é¦–å ‚ï¼š{format(preview[0], "yyyy-MM-dd")} (
              {["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"][preview[0].getDay()]})
              <br />
              æœ«å ‚ï¼š{format(preview[preview.length - 1], "yyyy-MM-dd")}
            </div>
          )}
        </div>

        <div className="flex gap-3">
          <Button variant="outline" onClick={onClose} className="flex-1">
            å–æ¶ˆ
          </Button>
          <Button
            variant="primary"
            onClick={handleSubmit}
            disabled={preview.length === 0 || isSubmitting}
            className="flex-1"
          >
            {isSubmitting ? "ç”Ÿæˆä¸­..." : `ç”Ÿæˆ ${preview.length} å€‹èª²å ‚`}
          </Button>
        </div>
      </div>
    </Modal>
  );
}

// è¼”åŠ©å‡½æ•¸ï¼šç”Ÿæˆèª²å ‚æ—¥æœŸ
function generateLessonDates(rule: GenerationRule): Date[] {
  const dates: Date[] = [];
  let current = new Date(rule.startDate);

  while (current <= rule.endDate) {
    const dayOfWeek = current.getDay() === 0 ? 7 : current.getDay();

    if (rule.weekdays.includes(dayOfWeek)) {
      // æª¢æŸ¥æ˜¯å¦åœ¨æ’é™¤åˆ—è¡¨ä¸­
      const isExcluded = rule.excludeDates.some((d) => isSameDay(d, current));

      if (!isExcluded) {
        dates.push(new Date(current));
      }
    }

    current = addDays(current, 1);
  }

  return dates;
}
```

### 2. èª²å ‚åˆ—è¡¨å¡ç‰‡

```tsx
// components/school-service/lesson/LessonCard.tsx
interface LessonCardProps {
  lesson: LessonWithTutors;
  lessonNumber: number;
  isAdmin?: boolean;
  onAssignTutor?: () => void;
  onEdit?: () => void;
  onDelete?: () => void;
}

export function LessonCard({
  lesson,
  lessonNumber,
  isAdmin,
  onAssignTutor,
  onEdit,
  onDelete,
}: LessonCardProps) {
  const hasUnassignedSlots =
    lesson.tutors.length < (lesson.requiredTutors || 1);

  return (
    <div
      className={cn(
        "rounded-lg border p-4 transition-shadow hover:shadow-sm",
        lesson.lessonStatus === "COMPLETED"
          ? "border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20"
          : hasUnassignedSlots
          ? "border-orange-200 bg-orange-50 dark:border-orange-800 dark:bg-orange-900/20"
          : "border-gray-200 dark:border-gray-700"
      )}
    >
      {/* æ¨™é¡Œè¡Œ */}
      <div className="flex items-center justify-between mb-2">
        <div className="flex items-center gap-2">
          <span className="text-sm text-gray-500">#{lessonNumber}</span>
          <span className="font-medium">
            {format(lesson.lessonDate, "MM/dd")} {lesson.startTime}
          </span>
          <LessonStatusBadge status={lesson.lessonStatus} />
        </div>

        {isAdmin && (
          <TableDropdown
            items={[
              { label: "ç·¨è¼¯", onClick: onEdit },
              { label: "åˆªé™¤", onClick: onDelete, danger: true },
            ]}
          />
        )}
      </div>

      {/* å°å¸«åˆ—è¡¨ */}
      <div className="space-y-1">
        {lesson.tutors.map((tutor) => (
          <div key={tutor.id} className="flex items-center gap-2 text-sm">
            <Avatar size="sm" name={tutor.user.name} />
            <span>{tutor.user.name}</span>
            <TutorRoleBadge role={tutor.tutorRole} />
            <AttendanceStatusBadge status={tutor.attendanceStatus} />
          </div>
        ))}

        {hasUnassignedSlots && (
          <button
            onClick={onAssignTutor}
            className="flex items-center gap-2 text-sm text-orange-600 hover:text-orange-700"
          >
            <PlusIcon className="h-4 w-4" />
            åˆ†é…å°å¸«
          </button>
        )}
      </div>

      {/* å®Œæˆè³‡æ–™ */}
      {lesson.lessonStatus === "COMPLETED" && (
        <div className="mt-2 pt-2 border-t border-green-200 dark:border-green-800 text-sm text-gray-600">
          å­¸ç”Ÿ {lesson.studentCount} äºº | æ”¶è²» HK${" "}
          {lesson.feeLesson?.toLocaleString()}
        </div>
      )}
    </div>
  );
}
```

### 3. æ‰¹æ¬¡ç”Ÿæˆ API

```typescript
// API: POST /api/courses/[id]/lessons/batch
export async function POST(
  request: Request,
  { params }: { params: { id: string } }
) {
  const session = await getServerSession();

  if (!session?.user || session.user.role !== "ADMIN") {
    return Response.json({ error: "Forbidden" }, { status: 403 });
  }

  const body = await request.json();
  const { rule, lessonDates } = body;

  try {
    const course = await prisma.schoolCourse.findUnique({
      where: { id: params.id },
    });

    if (!course) {
      return Response.json({ error: "èª²ç¨‹ä¸å­˜åœ¨" }, { status: 404 });
    }

    // ç²å–ç¾æœ‰èª²å ‚æ•¸é‡ï¼Œè¨ˆç®—å ‚æ•¸
    const existingLessons = await prisma.schoolLesson.count({
      where: { courseId: params.id, deletedAt: null },
    });

    // æ‰¹æ¬¡å»ºç«‹èª²å ‚
    const lessons = await prisma.schoolLesson.createMany({
      data: lessonDates.map((date: Date, index: number) => ({
        courseId: params.id,
        lessonDate: date,
        startTime: rule.startTime,
        endTime: rule.endTime,
        weekday: new Date(date).getDay() === 0 ? 7 : new Date(date).getDay(),
        lessonType: "REGULAR",
        lessonTerm: course.courseTerm,
        lessonNumber: existingLessons + index + 1,
        lessonStatus: "SCHEDULED",
        invoiceStatus: "NOT_INVOICED",
        paymentStatus: "UNPAID",
      })),
    });

    return Response.json({
      created: lessons.count,
      message: `æˆåŠŸå»ºç«‹ ${lessons.count} å€‹èª²å ‚`,
    });
  } catch (error) {
    console.error("æ‰¹æ¬¡ç”Ÿæˆå¤±æ•—:", error);
    return Response.json({ error: "ç”Ÿæˆå¤±æ•—" }, { status: 500 });
  }
}
```

---

## ğŸ’» ç¨‹å¼ç¢¼ç¯„ä¾‹

### é é¢ä¸»çµæ§‹

```tsx
// app/(private)/dashboard/school/courses/[id]/page.tsx
"use client";

import { useState } from "react";
import { useSession } from "next-auth/react";
import { useSearchParams } from "next/navigation";
import useSWR from "swr";
import { PageBreadCrumb } from "@/components/common/PageBreadCrumb";
import { Tabs, TabList, Tab, TabPanel } from "@/components/ui/tabs";
import { CourseInfoCard } from "./components/CourseInfoCard";
import { LessonCalendarView } from "./components/LessonCalendarView";
import { LessonListView } from "./components/LessonListView";
import { CourseStats } from "./components/CourseStats";
import { BatchLessonGenerator } from "./components/BatchLessonGenerator";

export default function CourseDetailPage({
  params,
}: {
  params: { id: string };
}) {
  const { data: session } = useSession();
  const searchParams = useSearchParams();

  const defaultTab = searchParams.get("tab") || "calendar";
  const [activeTab, setActiveTab] = useState(defaultTab);
  const [showBatchGenerator, setShowBatchGenerator] = useState(false);

  const isAdmin = session?.user?.role === "ADMIN";

  const {
    data: course,
    isLoading,
    mutate,
  } = useSWR(`/api/courses/${params.id}`, fetcher);

  if (isLoading) {
    return <div className="p-8 text-center">è¼‰å…¥ä¸­...</div>;
  }

  if (!course) {
    return <div className="p-8 text-center text-red-500">èª²ç¨‹ä¸å­˜åœ¨</div>;
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <PageBreadCrumb
          title={course.courseName}
          items={[{ label: "èª²ç¨‹ç®¡ç†", href: "/dashboard/school/courses" }]}
        />

        {isAdmin && (
          <div className="flex gap-2">
            <Button variant="outline" onClick={() => {}}>
              ç·¨è¼¯
            </Button>
          </div>
        )}
      </div>

      {/* èª²ç¨‹è³‡è¨Šå¡ */}
      <CourseInfoCard course={course} />

      {/* è¦–åœ–åˆ‡æ› */}
      <Tabs value={activeTab} onChange={setActiveTab}>
        <TabList>
          <Tab value="calendar">ğŸ“… æ—¥æ›†è¦–åœ–</Tab>
          <Tab value="list">ğŸ“‹ åˆ—è¡¨è¦–åœ–</Tab>
          <Tab value="stats">ğŸ“Š çµ±è¨ˆ</Tab>
        </TabList>

        <TabPanel value="calendar">
          <div className="flex gap-4 mb-4">
            {isAdmin && (
              <>
                <Button
                  variant="primary"
                  onClick={() => setShowBatchGenerator(true)}
                >
                  æ‰¹æ¬¡ç”Ÿæˆèª²å ‚
                </Button>
                <Button variant="outline">æ–°å¢å–®å ‚</Button>
              </>
            )}
          </div>

          <LessonCalendarView
            lessons={course.lessons}
            onLessonClick={(lesson) => {}}
          />
        </TabPanel>

        <TabPanel value="list">
          <LessonListView
            lessons={course.lessons}
            isAdmin={isAdmin}
            onRefresh={mutate}
          />
        </TabPanel>

        <TabPanel value="stats">
          <CourseStats stats={course.stats} />
        </TabPanel>
      </Tabs>

      {/* æ‰¹æ¬¡ç”Ÿæˆ Modal */}
      {showBatchGenerator && (
        <BatchLessonGenerator
          courseId={params.id}
          courseStartDate={new Date(course.startDate)}
          courseEndDate={course.endDate ? new Date(course.endDate) : undefined}
          onGenerate={() => mutate()}
          onClose={() => setShowBatchGenerator(false)}
        />
      )}
    </div>
  );
}
```

---

## âœ… é©—æ”¶æ¨™æº–

- [ ] é¡¯ç¤ºèª²ç¨‹åŸºæœ¬è³‡è¨Š
- [ ] æ—¥æ›†è¦–åœ–æ­£ç¢ºæ¨™ç¤ºæœ‰èª²å ‚çš„æ—¥æœŸ
- [ ] åˆ—è¡¨è¦–åœ–é¡¯ç¤ºæ‰€æœ‰èª²å ‚
- [ ] ADMIN å¯æ‰¹æ¬¡ç”Ÿæˆèª²å ‚
- [ ] é è¦½é¡¯ç¤ºæ­£ç¢ºçš„ç”Ÿæˆæ•¸é‡
- [ ] å¯æ‰‹å‹•æ–°å¢å–®å ‚
- [ ] æœªåˆ†é…å°å¸«çš„èª²å ‚é¡¯ç¤ºè­¦å‘Š
- [ ] çµ±è¨ˆè³‡æ–™æ­£ç¢ºè¨ˆç®—
- [ ] å”¯è®€è§’è‰²åªèƒ½æŸ¥çœ‹
