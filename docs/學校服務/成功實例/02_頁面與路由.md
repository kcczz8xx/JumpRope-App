# 頁面與路由設計

## 路由結構

```
app/(private)/dashboard/school/courses/new/page.tsx
```

### 路由群組說明

- `(private)` - 私有路由群組，需要身份驗證
- `dashboard` - 儀表板主路由
- `school/courses` - 學校課程管理
- `new` - 新增課程頁面

## 頁面元件實作

### 檔案位置

`@/app/(private)/dashboard/school/courses/new/page.tsx`

### 完整程式碼

```typescript
"use client";

import React, { useEffect, useState } from "react";
import PageBreadcrumb from "@/components/tailadmin/common/PageBreadCrumb";
import { NewCourseForm } from "@/components/feature/school-service/course";

interface School {
  id: string;
  schoolName: string;
}

const MOCK_SCHOOLS: School[] = [
  { id: "school_001", schoolName: "聖保羅小學" },
  { id: "school_002", schoolName: "培正小學" },
  // ... 更多學校
];

const USE_MOCK_DATA = true;

export default function NewCoursePage() {
  const [schools, setSchools] = useState<School[]>([]);
  const [isLoadingSchools, setIsLoadingSchools] = useState(true);

  useEffect(() => {
    async function fetchSchools() {
      if (USE_MOCK_DATA) {
        setTimeout(() => {
          setSchools(MOCK_SCHOOLS);
          setIsLoadingSchools(false);
        }, 500);
        return;
      }

      try {
        const response = await fetch("/api/school-service/schools");
        if (response.ok) {
          const data = await response.json();
          setSchools(data);
        }
      } catch (error) {
        console.error("Failed to fetch schools:", error);
      } finally {
        setIsLoadingSchools(false);
      }
    }

    fetchSchools();
  }, []);

  return (
    <>
      <PageBreadcrumb pageTitle="新增課程" />
      <NewCourseForm schools={schools} isLoadingSchools={isLoadingSchools} />
    </>
  );
}
```

## 設計決策

### 1. Client Component

```typescript
"use client";
```

**原因：**

- 需要使用 React Hooks (`useState`, `useEffect`)
- 需要處理使用者互動
- 需要動態載入資料

### 2. 學校列表載入策略

#### Mock Data 模式

```typescript
const USE_MOCK_DATA = true;
```

**優點：**

- 開發階段不需要實際 API
- 快速測試表單功能
- 避免資料庫依賴

**切換至實際 API：**

```typescript
const USE_MOCK_DATA = false; // 改為 false
```

#### 實際 API 模式

```typescript
const response = await fetch("/api/school-service/schools");
```

**實作要點：**

- 需要實作 `/api/school-service/schools` API Route
- 返回格式：`{ id: string, schoolName: string }[]`
- 處理載入狀態與錯誤

### 3. Loading State 管理

```typescript
const [isLoadingSchools, setIsLoadingSchools] = useState(true);
```

**用途：**

- 顯示載入動畫
- 防止使用者在資料載入完成前操作
- 提升使用者體驗

### 4. 麵包屑導航

```typescript
<PageBreadcrumb pageTitle="新增課程" />
```

**功能：**

- 顯示當前頁面位置
- 提供返回上層的導航
- 統一的 UI 風格

## 頁面生命週期

```
1. 頁面載入
   ↓
2. 初始化狀態 (schools=[], isLoadingSchools=true)
   ↓
3. useEffect 執行
   ↓
4. 載入學校列表 (Mock 或 API)
   ↓
5. 更新狀態 (schools=[...], isLoadingSchools=false)
   ↓
6. 渲染表單元件
   ↓
7. 使用者填寫表單
   ↓
8. 提交表單
   ↓
9. 跳轉至課程列表頁面
```

## 相關 API Endpoint

### 學校列表 API (未實作)

**Endpoint:** `GET /api/school-service/schools`

**Response:**

```json
[
  {
    "id": "cml13k3vs000041caeff9vomt",
    "schoolName": "聖保羅小學"
  }
]
```

**實作建議：**

```typescript
// app/api/school-service/schools/route.ts
import { NextResponse } from "next/server";
import { prisma } from "@/lib/prisma";

export async function GET() {
  try {
    const schools = await prisma.school.findMany({
      select: {
        id: true,
        schoolName: true,
      },
      orderBy: {
        schoolName: "asc",
      },
    });

    return NextResponse.json(schools);
  } catch (error) {
    return NextResponse.json({ message: "載入學校列表失敗" }, { status: 500 });
  }
}
```

## 頁面跳轉邏輯

### 提交成功後跳轉

```typescript
// 在 NewCourseForm.tsx 中
router.push(`/dashboard/school/courses?schoolId=${result.schoolId}`);
```

**跳轉目標：**

- 路由：`/dashboard/school/courses`
- Query 參數：`schoolId` - 新建立的學校 ID
- 用途：顯示該學校的課程列表

## 最佳實踐

### 1. 資料預載入

```typescript
useEffect(() => {
  fetchSchools();
}, []); // 空依賴陣列，只在掛載時執行一次
```

### 2. 錯誤處理

```typescript
try {
  const response = await fetch("/api/school-service/schools");
  if (response.ok) {
    const data = await response.json();
    setSchools(data);
  }
} catch (error) {
  console.error("Failed to fetch schools:", error);
  // 可以添加錯誤提示 UI
} finally {
  setIsLoadingSchools(false); // 確保載入狀態被重置
}
```

### 3. Mock Data 管理

```typescript
// 建議：將 Mock Data 移至獨立檔案
// lib/mock-data/schools.ts
export const MOCK_SCHOOLS = [
  { id: "school_001", schoolName: "聖保羅小學" },
  // ...
];
```

## 下一步

閱讀 **[03\_類型定義.md](./03_類型定義.md)** 了解資料結構與類型系統。
