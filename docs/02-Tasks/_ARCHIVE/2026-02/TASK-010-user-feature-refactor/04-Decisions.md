# 決策記錄

## DEC-001: 採用 Actions/Schemas 子目錄模式

**日期**: 2026-02-02

**背景**: 
`user` feature 的 `actions.ts` 達 16KB，包含 5 個不同邏輯域，需要拆分。

**選項評估**:

| 方案 | 優點 | 缺點 |
|:-----|:-----|:-----|
| A: 維持單一檔案 | 簡單直接 | 難維護、易衝突 |
| B: Actions/Schemas 子目錄 | 清晰分離、易查找 | 需一次性重構 |
| C: 提取獨立 Features | 最大解耦 | 過度工程化 |

**決定**: 採用方案 B

**理由**:
1. 符合業界實踐（Next.js 15 社群推薦）
2. 保持 Feature 封裝性（不違反 AGENTS.md 原則）
3. 對外 API 完全不變

---

## DEC-002: 設定 10KB 檔案大小閾值

**日期**: 2026-02-02

**決定**: 
在 `src/features/AGENTS.md` 新增規範：單一 actions/schema 檔案超過 10KB 或包含 3+ 邏輯域時，應考慮拆分為子目錄模式。

**理由**:
1. 提供明確的拆分觸發點
2. 避免過早優化，也避免過度膨脹
3. 16KB 的 user feature 是實際案例參考

---

## DEC-003: 暫不拆分 auth 和 school-service

**日期**: 2026-02-02

**背景**:
評估是否需要拆分其他 features。

**分析結果**:
- `auth` (389 行, ~12KB): 雖然超過閾值，但邏輯緊密耦合（OTP + Register + Password 是完整認證流程）
- `school-service` (352 行, ~11KB): 接近閾值，但只有 2 個邏輯域，規模可控

**決定**: 暫不拆分，待新增更多 actions 後再評估
