# 類型定義與資料結構

## 檔案位置

`@/components/feature/school-service/types/course.ts`

## 核心類型

### 1. 學校基本資料

```typescript
export interface SchoolBasicData {
  schoolId?: string; // 可選，選擇現有學校時使用
  schoolName: string; // 學校名稱（中文）
  schoolNameEn: string; // 學校名稱（英文）
  address: string; // 學校地址
  phone: string; // 學校電話
  email: string; // 學校電郵
  website: string; // 學校網站
  partnershipStartDate: string; // 合作開始日期 (YYYY-MM-DD)
  partnershipEndDate: string | null; // 合作結束日期（可選）
  partnershipStartYear?: string; // 合作學年（自動計算）
  confirmationChannel: string; // 確認渠道
  remarks: string; // 備註
}
```

**設計要點：**

- `schoolId` 為可選，支援新增/更新兩種模式
- 日期使用字串格式 `YYYY-MM-DD`
- `partnershipStartYear` 由前端自動計算

### 2. 聯絡人資料

```typescript
export interface SchoolContactData {
  nameChinese: string; // 中文姓名
  nameEnglish: string; // 英文姓名
  position: string; // 職位
  phone: string; // 電話
  mobile: string; // 手提電話
  email: string; // 電郵
  isPrimary: boolean; // 是否為主要聯絡人
}
```

**設計要點：**

- `isPrimary` 預設為 `true`
- 支援多語言姓名

### 3. 課程項目資料

```typescript
export interface CourseItemData {
  id: string; // 前端生成的 UUID
  courseName: string; // 課程名稱
  courseType: CourseType; // 課程類型
  courseTerm: CourseTerm; // 學期
  startDate: string | null; // 開始日期
  endDate: string | null; // 結束日期
  requiredTutors: number; // 所需導師數量
  maxStudents: number | null; // 最大學生數量
  courseDescription: string | null; // 課程描述
  chargingModel: ChargingModel[]; // 收費模式（多選）

  // 收費金額（依 chargingModel 而定）
  studentPerLessonFee: number | null;
  studentHourlyFee: number | null;
  studentFullCourseFee: number | null;
  teamActivityFee: number | null;
  tutorPerLessonFee: number | null;
  tutorHourlyFee: number | null;
}
```

**設計要點：**

- `id` 使用前端生成的 UUID，用於 React key 和陣列操作
- 收費欄位根據 `chargingModel` 動態顯示/隱藏
- 支援多種收費模式組合

### 4. 完整表單資料

```typescript
export interface NewCourseFormData {
  school: SchoolBasicData; // 學校資料
  contact: SchoolContactData; // 聯絡人資料
  academicYear: string; // 學年
  courses: CourseItemData[]; // 課程列表（支援多個）
}
```

## 列舉類型 (Enums)

### 1. 課程學期

```typescript
export enum CourseTerm {
  FULL_YEAR = "FULL_YEAR", // 全期不分學期
  FIRST_TERM = "FIRST_TERM", // 上學期
  SECOND_TERM = "SECOND_TERM", // 下學期
  SUMMER = "SUMMER", // 暑期
}

export const COURSE_TERM_LABELS: Record<CourseTerm, string> = {
  [CourseTerm.FULL_YEAR]: "全期",
  [CourseTerm.FIRST_TERM]: "上學期",
  [CourseTerm.SECOND_TERM]: "下學期",
  [CourseTerm.SUMMER]: "暑期",
};
```

### 2. 收費模式

```typescript
export enum ChargingModel {
  STUDENT_PER_LESSON = "STUDENT_PER_LESSON", // 學生每節課堂收費
  TUTOR_PER_LESSON = "TUTOR_PER_LESSON", // 導師每堂節數收費
  STUDENT_HOURLY = "STUDENT_HOURLY", // 學生課堂時數收費
  TUTOR_HOURLY = "TUTOR_HOURLY", // 導師時薪節數收費
  STUDENT_FULL_COURSE = "STUDENT_FULL_COURSE", // 學生全期課程收費
  TEAM_ACTIVITY = "TEAM_ACTIVITY", // 帶隊活動收費
}

export const CHARGING_MODEL_LABELS: Record<ChargingModel, string> = {
  [ChargingModel.STUDENT_PER_LESSON]: "學生每節課堂收費",
  [ChargingModel.TUTOR_PER_LESSON]: "導師每堂節數收費",
  [ChargingModel.STUDENT_HOURLY]: "學生課堂時數收費",
  [ChargingModel.TUTOR_HOURLY]: "導師時薪節數收費",
  [ChargingModel.STUDENT_FULL_COURSE]: "學生全期課程收費",
  [ChargingModel.TEAM_ACTIVITY]: "帶隊活動收費",
};
```

**設計要點：**

- 支援多選，使用陣列儲存
- 每種模式對應不同的收費欄位

### 3. 課程類型

```typescript
export type CourseType = string;

export const DEFAULT_COURSE_TYPES = [
  "興趣班",
  "表演班",
  "校隊班",
  "暑期班",
  "推廣活動",
] as const;
```

**設計要點：**

- 使用 `string` 而非 `enum`，允許自訂類型
- 提供預設選項供快速選擇

## 工具函式

### 1. 預設值生成

```typescript
export function getDefaultSchoolData(): SchoolBasicData {
  return {
    schoolId: undefined,
    schoolName: "",
    schoolNameEn: "",
    address: "",
    phone: "",
    email: "",
    website: "",
    partnershipStartDate: "",
    partnershipEndDate: null,
    confirmationChannel: "",
    remarks: "",
  };
}

export function getDefaultContactData(): SchoolContactData {
  return {
    nameChinese: "",
    nameEnglish: "",
    position: "",
    phone: "",
    mobile: "",
    email: "",
    isPrimary: true,
  };
}

export function getDefaultCourseItem(): CourseItemData {
  return {
    id: generateUUID(),
    courseName: "",
    courseType: "",
    courseTerm: CourseTerm.FULL_YEAR,
    startDate: null,
    endDate: null,
    requiredTutors: 1,
    maxStudents: null,
    courseDescription: null,
    chargingModel: [],
    studentPerLessonFee: null,
    studentHourlyFee: null,
    studentFullCourseFee: null,
    teamActivityFee: null,
    tutorPerLessonFee: null,
    tutorHourlyFee: null,
  };
}
```

### 2. 學年計算

```typescript
export function calculateAcademicYear(
  startDate: string,
  endDate: string | null
): string {
  if (!startDate) return "";

  const start = new Date(startDate);
  const startYear = start.getFullYear();

  if (endDate) {
    const end = new Date(endDate);
    const endYear = end.getFullYear();

    if (endYear !== startYear) {
      return `${startYear}-${endYear}`;
    }
  }

  return `${startYear}`;
}
```

**使用範例：**

```typescript
calculateAcademicYear("2026-01-01", "2028-01-02");
// 返回: "2026-2028"

calculateAcademicYear("2026-01-01", "2026-12-31");
// 返回: "2026"
```

### 3. UUID 生成

```typescript
function generateUUID(): string {
  if (typeof crypto !== "undefined" && crypto.randomUUID) {
    return crypto.randomUUID();
  }
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
    const r = (Math.random() * 16) | 0;
    const v = c === "x" ? r : (r & 0x3) | 0x8;
    return v.toString(16);
  });
}
```

**用途：**

- 為課程項目生成唯一 ID
- 用於 React key
- 用於陣列操作（新增/刪除課程）

### 4. 收入計算

```typescript
export function calculateCourseItemRevenue(
  course: CourseItemData,
  estimatedLessons: number = 12
): number {
  const studentCount = course.maxStudents || 0;
  let totalRevenue = 0;

  course.chargingModel.forEach((model) => {
    switch (model) {
      case ChargingModel.STUDENT_PER_LESSON:
        totalRevenue +=
          studentCount * (course.studentPerLessonFee || 0) * estimatedLessons;
        break;
      case ChargingModel.TUTOR_PER_LESSON:
        totalRevenue += (course.tutorPerLessonFee || 0) * estimatedLessons;
        break;
      // ... 其他模式
    }
  });

  return totalRevenue;
}
```

## 類型與 Prisma Schema 對應

### 資料庫欄位對應

| 前端類型欄位        | Prisma Schema 欄位 | 類型轉換              |
| ------------------- | ------------------ | --------------------- |
| `chargingModel`     | `chargingModels`   | `ChargingModel[]`     |
| `courseDescription` | `description`      | `string`              |
| `courseTerm`        | `courseTerm`       | `CourseTerm` enum     |
| `startDate`         | `startDate`        | `string` → `DateTime` |
| `endDate`           | `endDate`          | `string` → `DateTime` |

**注意事項：**

- 前端使用 `chargingModel`（單數），資料庫使用 `chargingModels`（複數）
- 日期需要轉換：`new Date(dateString)`

## 最佳實踐

### 1. 類型安全

```typescript
// ✅ 使用 enum 確保類型安全
const term: CourseTerm = CourseTerm.FIRST_TERM;

// ❌ 避免使用字串字面值
const term = "FIRST_TERM"; // 容易拼寫錯誤
```

### 2. 可選欄位處理

```typescript
// ✅ 使用 null 而非 undefined
studentPerLessonFee: number | null;

// ✅ 提供預設值
requiredTutors: number; // 預設為 1
```

### 3. 標籤對應

```typescript
// ✅ 使用 Record 類型確保完整性
export const COURSE_TERM_LABELS: Record<CourseTerm, string> = {
  [CourseTerm.FULL_YEAR]: "全期",
  // TypeScript 會檢查是否涵蓋所有 enum 值
};
```

## 下一步

閱讀 **[04\_表單元件.md](./04_表單元件.md)** 了解表單元件的實作細節。
