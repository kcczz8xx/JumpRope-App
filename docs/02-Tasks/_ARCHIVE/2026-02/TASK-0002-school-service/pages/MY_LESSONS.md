# ğŸ‘¨â€ğŸ« æˆ‘çš„èª²å ‚ - My Lessons

> **è·¯å¾‘**: `/dashboard/school/my-lessons`  
> **å„ªå…ˆç´š**: P0  
> **è§’è‰²**: TUTOR (ä¸»è¦), ADMIN (æŸ¥çœ‹æ¨¡å¼)

---

## ğŸ“‹ é é¢æ¦‚è¿°

å°å¸«å°ˆç”¨é é¢ï¼Œé¡¯ç¤ºå€‹äººçš„èª²å ‚æ’ç¨‹ã€ç°½åˆ°/ç°½é€€åŠŸèƒ½ï¼Œä»¥åŠè–ªè³‡é è¦½ã€‚è¨­è¨ˆä»¥æ‰‹æ©Ÿå„ªå…ˆï¼Œæ–¹ä¾¿å°å¸«åœ¨å¤–å ´ä½¿ç”¨ã€‚

---

## ğŸ¨ é é¢çµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¨â€ğŸ« æˆ‘çš„èª²å ‚                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“… ä»Šå¤© | æœ¬é€± | æœ¬æœˆ | è‡ªè¨‚                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸŸ¢ ä»Šå¤© 14:00 - 15:30                               â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚ ğŸ“ è–ä¿ç¾…å°å­¸                                       â”‚   â”‚
â”‚  â”‚ ğŸ“š èŠ±å¼è·³ç¹©åˆç­                                     â”‚   â”‚
â”‚  â”‚ ğŸ‘¥ å­¸ç”Ÿï¼š25 äºº | ğŸ·ï¸ ä¸»æ•™                            â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ âœ… å·²ç°½åˆ° 14:05                                     â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚ â”‚   ç°½é€€     â”‚ â”‚  æŸ¥çœ‹è©³æƒ…  â”‚ â”‚  æŸ¥çœ‹è·¯ç·š  â”‚    â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”µ æ˜å¤© 10:00 - 11:00                               â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚ ğŸ“ åŸ¹æ­£ä¸­å­¸                                         â”‚   â”‚
â”‚  â”‚ ğŸ“š é€Ÿåº¦è·³è¨“ç·´                                       â”‚   â”‚
â”‚  â”‚ ğŸ‘¥ é è¨ˆ 30 äºº | ğŸ·ï¸ åŠ©æ•™                             â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ â° å¾…ç°½åˆ°                                           â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚ â”‚  æŸ¥çœ‹è©³æƒ…  â”‚ â”‚  æŸ¥çœ‹è·¯ç·š  â”‚                    â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ’° æœ¬æœˆè–ªè³‡é è¦½                                     â”‚   â”‚
â”‚  â”‚ â”œâ”€ å·²å®Œæˆï¼š12 å ‚                                    â”‚   â”‚
â”‚  â”‚ â”œâ”€ å¾…ç¢ºèªè–ªè³‡ï¼šHK$ 4,800                           â”‚   â”‚
â”‚  â”‚ â””â”€ [ æŸ¥çœ‹è©³ç´°è–ªè³‡å–® ]                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© ä½¿ç”¨çµ„ä»¶

### TailAdmin çµ„ä»¶

| çµ„ä»¶         | è·¯å¾‘                              | ç”¨é€”           |
| ------------ | --------------------------------- | -------------- |
| `Tabs`       | `components/ui/tabs/`             | æ—¥æœŸç¯©é¸       |
| `Badge`      | `components/ui/badge/Badge.tsx`   | ç‹€æ…‹/è§’è‰²æ¨™ç±¤  |
| `Button`     | `components/ui/button/`           | æ“ä½œæŒ‰éˆ•       |
| `Modal`      | `components/ui/modal/`            | ç°½åˆ°ç¢ºèª Modal |
| `DatePicker` | `components/form/date-picker.tsx` | è‡ªè¨‚æ—¥æœŸ       |

### éœ€é–‹ç™¼çµ„ä»¶

| çµ„ä»¶                | èªªæ˜                      |
| ------------------- | ------------------------- |
| `TutorLessonCard`   | å°å¸«èª²å ‚å¡ç‰‡              |
| `AttendanceButton`  | ç°½åˆ°/ç°½é€€æŒ‰éˆ•             |
| `CheckInModal`      | ç°½åˆ° Modalï¼ˆå«æ‹ç…§ã€GPSï¼‰ |
| `SalarySummaryCard` | è–ªè³‡é è¦½å¡ç‰‡              |

---

## ğŸ“Š è³‡æ–™çµæ§‹

### èª²å ‚è³‡æ–™

```typescript
interface TutorLessonView {
  id: string; // SchoolTutorLesson.id
  lessonId: string;

  // æ™‚é–“è³‡æ–™
  lessonDate: Date;
  startTime: string; // "14:00"
  endTime: string; // "15:30"

  // èª²ç¨‹è³‡æ–™
  courseName: string;
  courseType: CourseType;

  // å­¸æ ¡è³‡æ–™
  schoolName: string;
  schoolAddress: string;

  // å°å¸«è³‡æ–™
  tutorRole: TutorRole; // HEAD_COACH | ASSISTANT | TRAINEE

  // ç°½åˆ°ç‹€æ…‹
  attendanceStatus: AttendanceStatus;
  checkInTime?: Date;
  checkOutTime?: Date;

  // èª²å ‚è³‡æ–™
  expectedStudents?: number;
  actualStudents?: number;
  lessonStatus: LessonStatus;
}
```

### è³‡æ–™æŸ¥è©¢

```typescript
// API: GET /api/tutor/lessons
async function getTutorLessons(
  userId: string,
  dateRange: { start: Date; end: Date }
) {
  return await prisma.schoolTutorLesson.findMany({
    where: {
      userId,
      lessonDate: {
        gte: dateRange.start,
        lte: dateRange.end,
      },
    },
    include: {
      lesson: {
        include: {
          course: {
            include: {
              school: {
                select: {
                  id: true,
                  schoolName: true,
                  address: true,
                },
              },
            },
          },
        },
      },
    },
    orderBy: [{ lessonDate: "asc" }, { startTime: "asc" }],
  });
}
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ—¥æœŸç¯©é¸

```typescript
type DateFilter = "today" | "this_week" | "this_month" | "custom";

function getDateRange(
  filter: DateFilter,
  customRange?: { start: Date; end: Date }
) {
  const now = new Date();

  switch (filter) {
    case "today":
      return {
        start: startOfDay(now),
        end: endOfDay(now),
      };
    case "this_week":
      return {
        start: startOfWeek(now, { weekStartsOn: 1 }),
        end: endOfWeek(now, { weekStartsOn: 1 }),
      };
    case "this_month":
      return {
        start: startOfMonth(now),
        end: endOfMonth(now),
      };
    case "custom":
      return customRange!;
  }
}
```

### 2. ç°½åˆ°åŠŸèƒ½

```typescript
// API: POST /api/tutor/lessons/[id]/check-in
interface CheckInRequest {
  lessonId: string;
  checkInImage?: string; // Base64 åœ–ç‰‡
  geoLocation?: {
    latitude: number;
    longitude: number;
  };
}

async function checkIn(data: CheckInRequest) {
  const now = new Date();

  // æª¢æŸ¥æ˜¯å¦ç‚ºä»Šå¤©çš„èª²å ‚
  const tutorLesson = await prisma.schoolTutorLesson.findFirst({
    where: {
      lessonId: data.lessonId,
      userId: session.user.id,
    },
    include: { lesson: true },
  });

  if (!tutorLesson) {
    throw new Error("æ‚¨æœªè¢«åˆ†é…åˆ°æ­¤èª²å ‚");
  }

  if (!isSameDay(tutorLesson.lessonDate, now)) {
    throw new Error("åªèƒ½ç°½åˆ°ä»Šå¤©çš„èª²å ‚");
  }

  // æ›´æ–°ç°½åˆ°è¨˜éŒ„
  return await prisma.schoolTutorLesson.update({
    where: { id: tutorLesson.id },
    data: {
      attendanceStatus: "CHECKED_IN",
      checkInTime: now,
      checkInImage: data.checkInImage,
      geoLocation: data.geoLocation
        ? `${data.geoLocation.latitude},${data.geoLocation.longitude}`
        : null,
    },
  });
}
```

### 3. ç°½é€€åŠŸèƒ½

```typescript
// API: POST /api/tutor/lessons/[id]/check-out
interface CheckOutRequest {
  lessonId: string;
  actualStudents: number; // å¯¦éš›å­¸ç”Ÿäººæ•¸
  notes?: string;
}

async function checkOut(data: CheckOutRequest) {
  const now = new Date();

  const tutorLesson = await prisma.schoolTutorLesson.findFirst({
    where: {
      lessonId: data.lessonId,
      userId: session.user.id,
      attendanceStatus: "CHECKED_IN",
    },
  });

  if (!tutorLesson) {
    throw new Error("è«‹å…ˆç°½åˆ°");
  }

  // è¨ˆç®—å·¥ä½œæ™‚é•·
  const workingMinutes = differenceInMinutes(now, tutorLesson.checkInTime!);

  // è¨ˆç®—è–ªè³‡
  const salaryAmount = calculateSalary(tutorLesson, workingMinutes);

  // æ›´æ–°è¨˜éŒ„
  await prisma.$transaction([
    prisma.schoolTutorLesson.update({
      where: { id: tutorLesson.id },
      data: {
        attendanceStatus: "COMPLETED",
        checkOutTime: now,
        workingMinutes,
        salaryAmount,
      },
    }),
    // åŒæ™‚æ›´æ–°èª²å ‚è¨˜éŒ„
    prisma.schoolLesson.update({
      where: { id: data.lessonId },
      data: {
        studentCount: data.actualStudents,
        lessonStatus: "COMPLETED",
        notes: data.notes,
      },
    }),
  ]);
}
```

---

## ğŸ¨ å¡ç‰‡ç‹€æ…‹è¨­è¨ˆ

### ç‹€æ…‹é¡è‰²

| ç‹€æ…‹       | é‚Šæ¡†é¡è‰²           | èƒŒæ™¯è‰²        | èªªæ˜         |
| ---------- | ------------------ | ------------- | ------------ |
| ä»Šå¤©å¾…ç°½åˆ° | `border-blue-500`  | `bg-blue-50`  | ä»Šå¤©çš„èª²å ‚   |
| å·²ç°½åˆ°     | `border-green-500` | `bg-green-50` | é€²è¡Œä¸­       |
| å·²å®Œæˆ     | `border-gray-300`  | `bg-gray-50`  | å·²ç°½é€€       |
| æœªä¾†èª²å ‚   | `border-gray-200`  | `bg-white`    | æœªä¾†æ—¥æœŸ     |
| å·²éæœŸ     | `border-red-300`   | `bg-red-50`   | éå»ä½†æœªç°½åˆ° |

### ç‹€æ…‹å¾½ç« 

```tsx
function AttendanceStatusBadge({ status }: { status: AttendanceStatus }) {
  const config = {
    SCHEDULED: { color: "gray", text: "å¾…ç°½åˆ°" },
    CHECKED_IN: { color: "blue", text: "å·²ç°½åˆ°" },
    COMPLETED: { color: "green", text: "å·²å®Œæˆ" },
    ABSENT: { color: "red", text: "ç¼ºå¸­" },
    LATE: { color: "orange", text: "é²åˆ°" },
  };

  const { color, text } = config[status];

  return (
    <Badge variant="light" color={color}>
      {text}
    </Badge>
  );
}
```

### è§’è‰²å¾½ç« 

```tsx
function TutorRoleBadge({ role }: { role: TutorRole }) {
  const config = {
    HEAD_COACH: { color: "primary", text: "ä¸»æ•™" },
    ASSISTANT: { color: "info", text: "åŠ©æ•™" },
    TRAINEE: { color: "warning", text: "å¯¦ç¿’" },
  };

  const { color, text } = config[role];

  return (
    <Badge variant="solid" color={color}>
      {text}
    </Badge>
  );
}
```

---

## ğŸ’» ç¨‹å¼ç¢¼ç¯„ä¾‹

### é é¢çµæ§‹

```tsx
// app/(private)/dashboard/school/my-lessons/page.tsx
"use client";

import { useState } from "react";
import { useSession } from "next-auth/react";
import useSWR from "swr";
import { PageBreadCrumb } from "@/components/common/PageBreadCrumb";
import { DateFilterTabs } from "./components/DateFilterTabs";
import { TutorLessonCard } from "./components/TutorLessonCard";
import { SalarySummaryCard } from "./components/SalarySummaryCard";
import { CheckInModal } from "./components/CheckInModal";
import { CheckOutModal } from "./components/CheckOutModal";

export default function MyLessonsPage() {
  const { data: session } = useSession();
  const [dateFilter, setDateFilter] = useState<DateFilter>("today");
  const [customRange, setCustomRange] = useState<{
    start: Date;
    end: Date;
  } | null>(null);
  const [selectedLesson, setSelectedLesson] = useState<TutorLessonView | null>(
    null
  );
  const [modalType, setModalType] = useState<"checkin" | "checkout" | null>(
    null
  );

  const dateRange = getDateRange(dateFilter, customRange || undefined);

  const { data: lessons, mutate } = useSWR(
    `/api/tutor/lessons?start=${dateRange.start.toISOString()}&end=${dateRange.end.toISOString()}`,
    fetcher
  );

  const handleCheckIn = (lesson: TutorLessonView) => {
    setSelectedLesson(lesson);
    setModalType("checkin");
  };

  const handleCheckOut = (lesson: TutorLessonView) => {
    setSelectedLesson(lesson);
    setModalType("checkout");
  };

  const handleModalClose = () => {
    setSelectedLesson(null);
    setModalType(null);
    mutate(); // é‡æ–°ç²å–è³‡æ–™
  };

  // åˆ†çµ„ï¼šä»Šå¤© / æœªä¾†
  const todayLessons = lessons?.filter((l) => isToday(l.lessonDate)) || [];
  const futureLessons =
    lessons?.filter((l) => isAfter(l.lessonDate, new Date())) || [];
  const pastLessons =
    lessons?.filter((l) => isBefore(l.lessonDate, startOfDay(new Date()))) ||
    [];

  return (
    <div className="space-y-6">
      <PageBreadCrumb title="æˆ‘çš„èª²å ‚" />

      {/* æ—¥æœŸç¯©é¸ */}
      <DateFilterTabs
        value={dateFilter}
        onChange={setDateFilter}
        customRange={customRange}
        onCustomRangeChange={setCustomRange}
      />

      {/* èª²å ‚åˆ—è¡¨ */}
      <div className="space-y-4">
        {/* ä»Šå¤©çš„èª²å ‚ */}
        {todayLessons.length > 0 && (
          <section>
            <h2 className="text-lg font-semibold mb-3">ä»Šå¤©</h2>
            <div className="space-y-3">
              {todayLessons.map((lesson) => (
                <TutorLessonCard
                  key={lesson.id}
                  lesson={lesson}
                  isToday
                  onCheckIn={() => handleCheckIn(lesson)}
                  onCheckOut={() => handleCheckOut(lesson)}
                />
              ))}
            </div>
          </section>
        )}

        {/* æœªä¾†èª²å ‚ */}
        {futureLessons.length > 0 && (
          <section>
            <h2 className="text-lg font-semibold mb-3">å³å°‡åˆ°ä¾†</h2>
            <div className="space-y-3">
              {futureLessons.map((lesson) => (
                <TutorLessonCard key={lesson.id} lesson={lesson} />
              ))}
            </div>
          </section>
        )}

        {/* ç©ºç‹€æ…‹ */}
        {lessons?.length === 0 && (
          <div className="text-center py-12 text-gray-500">æ²’æœ‰èª²å ‚è¨˜éŒ„</div>
        )}
      </div>

      {/* è–ªè³‡é è¦½ */}
      <SalarySummaryCard userId={session?.user?.id} />

      {/* ç°½åˆ° Modal */}
      {modalType === "checkin" && selectedLesson && (
        <CheckInModal lesson={selectedLesson} onClose={handleModalClose} />
      )}

      {/* ç°½é€€ Modal */}
      {modalType === "checkout" && selectedLesson && (
        <CheckOutModal lesson={selectedLesson} onClose={handleModalClose} />
      )}
    </div>
  );
}
```

### TutorLessonCard çµ„ä»¶

```tsx
// components/school-service/tutor/TutorLessonCard.tsx
interface TutorLessonCardProps {
  lesson: TutorLessonView;
  isToday?: boolean;
  onCheckIn?: () => void;
  onCheckOut?: () => void;
}

export function TutorLessonCard({
  lesson,
  isToday = false,
  onCheckIn,
  onCheckOut,
}: TutorLessonCardProps) {
  const canCheckIn = isToday && lesson.attendanceStatus === "SCHEDULED";
  const canCheckOut = lesson.attendanceStatus === "CHECKED_IN";

  // æ ¹æ“šç‹€æ…‹æ±ºå®šå¡ç‰‡æ¨£å¼
  const cardClasses = cn(
    "rounded-xl border-2 p-4 transition-shadow hover:shadow-md",
    {
      "border-blue-500 bg-blue-50 dark:bg-blue-900/20":
        isToday && lesson.attendanceStatus === "SCHEDULED",
      "border-green-500 bg-green-50 dark:bg-green-900/20":
        lesson.attendanceStatus === "CHECKED_IN",
      "border-gray-300 bg-gray-50 dark:bg-gray-800":
        lesson.attendanceStatus === "COMPLETED",
      "border-gray-200 bg-white dark:bg-gray-900":
        !isToday && lesson.attendanceStatus === "SCHEDULED",
    }
  );

  return (
    <div className={cardClasses}>
      {/* æ™‚é–“æ¨™é¡Œ */}
      <div className="flex items-center justify-between mb-3">
        <div className="flex items-center gap-2">
          <span className="text-lg font-semibold">
            {format(lesson.lessonDate, "Mæœˆdæ—¥")} {lesson.startTime} -{" "}
            {lesson.endTime}
          </span>
          {isToday && (
            <Badge variant="solid" color="primary">
              ä»Šå¤©
            </Badge>
          )}
        </div>
        <AttendanceStatusBadge status={lesson.attendanceStatus} />
      </div>

      {/* èª²ç¨‹è³‡è¨Š */}
      <div className="space-y-2 mb-4">
        <div className="flex items-center gap-2 text-gray-600 dark:text-gray-400">
          <MapPinIcon className="h-4 w-4" />
          <span>{lesson.schoolName}</span>
        </div>
        <div className="flex items-center gap-2 text-gray-600 dark:text-gray-400">
          <BookIcon className="h-4 w-4" />
          <span>{lesson.courseName}</span>
        </div>
        <div className="flex items-center gap-3">
          <div className="flex items-center gap-1 text-gray-600 dark:text-gray-400">
            <UsersIcon className="h-4 w-4" />
            <span>
              {lesson.actualStudents
                ? `${lesson.actualStudents} äºº`
                : `é è¨ˆ ${lesson.expectedStudents || "?"} äºº`}
            </span>
          </div>
          <TutorRoleBadge role={lesson.tutorRole} />
        </div>
      </div>

      {/* ç°½åˆ°æ™‚é–“ */}
      {lesson.checkInTime && (
        <div className="text-sm text-green-600 mb-4">
          âœ… å·²ç°½åˆ° {format(lesson.checkInTime, "HH:mm")}
        </div>
      )}

      {/* æ“ä½œæŒ‰éˆ• */}
      <div className="flex flex-wrap gap-2">
        {canCheckIn && (
          <Button
            onClick={onCheckIn}
            className="flex-1 min-h-[48px]"
            variant="primary"
          >
            ç°½åˆ°
          </Button>
        )}

        {canCheckOut && (
          <Button
            onClick={onCheckOut}
            className="flex-1 min-h-[48px]"
            variant="success"
          >
            ç°½é€€
          </Button>
        )}

        <Button
          onClick={() =>
            window.open(getGoogleMapsUrl(lesson.schoolAddress), "_blank")
          }
          variant="outline"
          className="min-h-[48px]"
        >
          æŸ¥çœ‹è·¯ç·š
        </Button>
      </div>
    </div>
  );
}
```

### CheckInModal çµ„ä»¶

```tsx
// components/school-service/tutor/CheckInModal.tsx
interface CheckInModalProps {
  lesson: TutorLessonView;
  onClose: () => void;
}

export function CheckInModal({ lesson, onClose }: CheckInModalProps) {
  const [image, setImage] = useState<string | null>(null);
  const [location, setLocation] = useState<GeolocationCoordinates | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // ç²å– GPS ä½ç½®
  useEffect(() => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => setLocation(position.coords),
        (err) => console.warn("ç„¡æ³•ç²å–ä½ç½®:", err)
      );
    }
  }, []);

  const handleCapture = (imageData: string) => {
    setImage(imageData);
  };

  const handleSubmit = async () => {
    setLoading(true);
    setError(null);

    try {
      await fetch(`/api/tutor/lessons/${lesson.lessonId}/check-in`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          checkInImage: image,
          geoLocation: location
            ? {
                latitude: location.latitude,
                longitude: location.longitude,
              }
            : null,
        }),
      });

      onClose();
    } catch (err) {
      setError("ç°½åˆ°å¤±æ•—ï¼Œè«‹é‡è©¦");
    } finally {
      setLoading(false);
    }
  };

  return (
    <Modal isOpen onClose={onClose} className="max-w-md">
      <div className="p-6">
        <h3 className="text-xl font-semibold mb-4">ç°½åˆ°ç¢ºèª</h3>

        <div className="mb-4">
          <p className="text-gray-600">
            {lesson.schoolName} - {lesson.courseName}
          </p>
          <p className="text-gray-600">
            {format(lesson.lessonDate, "yyyyå¹´Mæœˆdæ—¥")} {lesson.startTime}
          </p>
        </div>

        {/* ç›¸æ©Ÿæ‹ç…§ */}
        <div className="mb-4">
          <p className="text-sm font-medium mb-2">æ‹æ”ç¾å ´ç›¸ç‰‡ï¼ˆå¯é¸ï¼‰</p>
          <CameraCapture onCapture={handleCapture} />
          {image && (
            <img
              src={image}
              alt="ç°½åˆ°ç›¸ç‰‡"
              className="mt-2 rounded-lg max-h-48"
            />
          )}
        </div>

        {/* GPS ä½ç½® */}
        <div className="mb-4 text-sm text-gray-500">
          {location ? (
            <span>ğŸ“ å·²ç²å–ä½ç½®</span>
          ) : (
            <span>â³ æ­£åœ¨ç²å–ä½ç½®...</span>
          )}
        </div>

        {error && <div className="mb-4 text-red-600 text-sm">{error}</div>}

        <div className="flex gap-3">
          <Button variant="outline" onClick={onClose} className="flex-1">
            å–æ¶ˆ
          </Button>
          <Button
            variant="primary"
            onClick={handleSubmit}
            disabled={loading}
            className="flex-1"
          >
            {loading ? "ç°½åˆ°ä¸­..." : "ç¢ºèªç°½åˆ°"}
          </Button>
        </div>
      </div>
    </Modal>
  );
}
```

---

## ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆ

æ­¤é é¢ä»¥**æ‰‹æ©Ÿå„ªå…ˆ**è¨­è¨ˆï¼š

| å…ƒç´      | æ‰‹æ©Ÿ             | æ¡Œé¢           |
| -------- | ---------------- | -------------- |
| å¡ç‰‡å¯¬åº¦ | 100%             | max-w-2xl å±…ä¸­ |
| æŒ‰éˆ•é«˜åº¦ | min-h-[48px]     | min-h-[40px]   |
| å­—é«”å¤§å° | ç•¥å¤§ï¼ˆæ–¹ä¾¿è§¸æ§ï¼‰ | æ¨™æº–           |
| é–“è·     | è¼ƒå¤§             | æ¨™æº–           |

---

## âœ… é©—æ”¶æ¨™æº–

- [ ] å°å¸«å¯æŸ¥çœ‹è‡ªå·±çš„èª²å ‚åˆ—è¡¨
- [ ] æ—¥æœŸç¯©é¸æ­£ç¢ºé‹ä½œ
- [ ] åªèƒ½ç°½åˆ°ç•¶å¤©çš„èª²å ‚
- [ ] ç°½åˆ°éœ€å…ˆç°½åˆ°æ‰èƒ½ç°½é€€
- [ ] ç°½åˆ°å¯æ‹ç…§ä¸¦è¨˜éŒ„ GPS
- [ ] ç°½é€€éœ€å¡«å¯«å¯¦éš›å­¸ç”Ÿäººæ•¸
- [ ] è–ªè³‡é è¦½é¡¯ç¤ºæ­£ç¢º
- [ ] ADMIN å¯æŸ¥çœ‹æ‰€æœ‰å°å¸«çš„èª²å ‚ï¼ˆå”¯è®€ï¼‰
- [ ] æ‰‹æ©Ÿç«¯æ“ä½œæµæš¢
