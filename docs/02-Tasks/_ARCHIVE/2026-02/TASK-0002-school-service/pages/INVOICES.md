# ğŸ’³ ç™¼ç¥¨åˆ—è¡¨ - Invoices

> **è·¯å¾‘**: `/dashboard/school/invoices`  
> **å„ªå…ˆç´š**: P0  
> **è§’è‰²**: ADMIN (CRUD), FINANCE (CRUD), SCHOOL_ADMIN (å”¯è®€)

---

## ğŸ“‹ é é¢æ¦‚è¿°

ç™¼ç¥¨ç®¡ç†åˆ—è¡¨é ï¼Œé¡¯ç¤ºæ‰€æœ‰ç™¼ç¥¨ç‹€æ…‹ã€é‡‘é¡ï¼Œæ”¯æ´å¿«é€Ÿæ“ä½œï¼ˆå‚¬æ¬¾ã€è¨˜éŒ„æ”¶æ¬¾ï¼‰ã€‚

---

## ğŸ¨ é é¢çµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’³ ç™¼ç¥¨ç®¡ç†                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç‹€æ…‹: [å…¨éƒ¨â–¼] [å¾…ç™¼é€] [å·²ç™¼é€] [å·²é€¾æœŸ] [å·²ä»˜æ¬¾]  â”‚   â”‚
â”‚  â”‚ å­¸æ ¡: [å…¨éƒ¨å­¸æ ¡________â–¼]       [â• ç”Ÿæˆç™¼ç¥¨]       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ â”‚ ç™¼ç¥¨ç·¨è™Ÿâ”‚ å­¸æ ¡       â”‚ é‡‘é¡     â”‚ åˆ°æœŸæ—¥  â”‚ ç‹€æ…‹  â”‚ æ“ä½œ   â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ â”‚INV-001  â”‚ è–ä¿ç¾…å°å­¸ â”‚ $12,000  â”‚å·²é€¾æœŸ3å¤©â”‚ğŸ”´é€¾æœŸ â”‚[å‚¬æ¬¾]  â”‚
â”‚  â”‚ â”‚INV-002  â”‚ åŸ¹æ­£ä¸­å­¸   â”‚ $8,500   â”‚ 12/05   â”‚ğŸ”µå·²ç™¼é€â”‚[è¨˜éŒ„]  â”‚
â”‚  â”‚ â”‚INV-003  â”‚ å”æ©ä¸­å­¸   â”‚ $6,000   â”‚ 12/10   â”‚ğŸ”µå·²ç™¼é€â”‚[æŸ¥çœ‹]  â”‚
â”‚  â”‚ â”‚INV-004  â”‚ è–ä¿ç¾…å°å­¸ â”‚ $4,500   â”‚ -       â”‚ğŸŸ¢å·²ä»˜æ¬¾â”‚[æ”¶æ“š]  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚                                                          â”‚
â”‚  â”‚ é¡¯ç¤º 1-10 / å…± 45 å¼µ                    [<] 1 2 3 ... [>]â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“Š çµ±è¨ˆæ‘˜è¦                                          â”‚   â”‚
â”‚  â”‚ â”œâ”€ æœ¬æœˆé–‹ç¥¨ï¼š10 å¼µï¼ŒHK$ 95,000                       â”‚   â”‚
â”‚  â”‚ â”œâ”€ å·²æ”¶æ¬¾ï¼š6 å¼µï¼ŒHK$ 52,000                          â”‚   â”‚
â”‚  â”‚ â””â”€ å¾…æ”¶æ¬¾ï¼š4 å¼µï¼ŒHK$ 43,000                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© ä½¿ç”¨çµ„ä»¶

### TailAdmin çµ„ä»¶

| çµ„ä»¶           | è·¯å¾‘                                  | ç”¨é€”     |
| -------------- | ------------------------------------- | -------- |
| `InvoiceList`  | `components/invoice/InvoiceList.tsx`  | åƒè€ƒçµæ§‹ |
| `InvoiceTable` | `components/invoice/InvoiceTable.tsx` | åƒè€ƒçµæ§‹ |
| `DataTables`   | `components/tables/DataTables/`       | è¡¨æ ¼     |
| `Badge`        | `components/ui/badge/Badge.tsx`       | ç‹€æ…‹æ¨™ç±¤ |
| `Pagination`   | `components/ui/pagination/`           | åˆ†é      |
| `MultiSelect`  | `components/form/MultiSelect.tsx`     | å­¸æ ¡ç¯©é¸ |

### éœ€é–‹ç™¼çµ„ä»¶

| çµ„ä»¶                 | èªªæ˜         |
| -------------------- | ------------ |
| `InvoiceStatusBadge` | ç™¼ç¥¨ç‹€æ…‹æ¨™ç±¤ |
| `QuickPaymentModal`  | å¿«é€Ÿæ”¶æ¬¾å½ˆçª— |
| `InvoiceSummaryCard` | çµ±è¨ˆæ‘˜è¦å¡ç‰‡ |

---

## ğŸ“Š è³‡æ–™çµæ§‹

### ç™¼ç¥¨åˆ—è¡¨è³‡æ–™

```typescript
interface InvoiceListItem {
  id: string;
  invoiceNumber: string;

  school: {
    id: string;
    schoolName: string;
  };

  invoiceDate: Date;
  dueDate?: Date;

  invoiceAmount: number;
  paidAmount: number;

  status: InvoiceDocStatus;

  // è¨ˆç®—å±¬æ€§
  pendingAmount: number;
  daysOverdue?: number;
}
```

### æŸ¥è©¢åƒæ•¸

```typescript
interface InvoiceListParams {
  status?: InvoiceDocStatus | "all";
  schoolIds?: string[];
  dateFrom?: Date;
  dateTo?: Date;
  page?: number;
  pageSize?: number;
}
```

### API æŸ¥è©¢

```typescript
// API: GET /api/invoices
async function getInvoices(params: InvoiceListParams, session: Session) {
  const { status, schoolIds, page = 1, pageSize = 10 } = params;

  let where: Prisma.SchoolInvoiceWhereInput = {
    deletedAt: null,
    ...(status && status !== "all" && { status }),
    ...(schoolIds?.length && { schoolId: { in: schoolIds } }),
  };

  // SCHOOL_ADMIN åªèƒ½æŸ¥çœ‹è‡ªå·±å­¸æ ¡
  if (session.user.role === "SCHOOL_ADMIN") {
    where.schoolId = session.user.schoolId;
  }

  const [invoices, total] = await Promise.all([
    prisma.schoolInvoice.findMany({
      where,
      include: {
        school: { select: { id: true, schoolName: true } },
      },
      orderBy: { invoiceDate: "desc" },
      skip: (page - 1) * pageSize,
      take: pageSize,
    }),
    prisma.schoolInvoice.count({ where }),
  ]);

  // è¨ˆç®—é€¾æœŸå¤©æ•¸
  const now = new Date();
  const invoicesWithCalc = invoices.map((inv) => ({
    ...inv,
    pendingAmount: Number(inv.invoiceAmount) - Number(inv.paidAmount),
    daysOverdue:
      inv.dueDate && inv.status !== "PAID" && inv.dueDate < now
        ? Math.floor(
            (now.getTime() - inv.dueDate.getTime()) / (1000 * 60 * 60 * 24)
          )
        : undefined,
  }));

  return {
    data: invoicesWithCalc,
    pagination: {
      page,
      pageSize,
      total,
      totalPages: Math.ceil(total / pageSize),
    },
  };
}
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. ç™¼ç¥¨ç‹€æ…‹æ¨™ç±¤

```tsx
function InvoiceStatusBadge({
  status,
  dueDate,
  paidAmount,
  invoiceAmount,
}: {
  status: InvoiceDocStatus;
  dueDate?: Date;
  paidAmount: number;
  invoiceAmount: number;
}) {
  // è¨ˆç®—å¯¦éš›é¡¯ç¤ºç‹€æ…‹
  const getDisplayStatus = () => {
    if (status === "PAID") return { color: "green", text: "å·²ä»˜æ¬¾" };
    if (status === "CANCELLED") return { color: "gray", text: "å·²å–æ¶ˆ" };
    if (status === "DRAFT") return { color: "gray", text: "è‰ç¨¿" };

    // æª¢æŸ¥æ˜¯å¦é€¾æœŸ
    if (dueDate && new Date() > dueDate) {
      const days = Math.floor(
        (new Date().getTime() - dueDate.getTime()) / (1000 * 60 * 60 * 24)
      );
      return { color: "red", text: `å·²é€¾æœŸ ${days} å¤©` };
    }

    // æª¢æŸ¥æ˜¯å¦éƒ¨åˆ†ä»˜æ¬¾
    if (paidAmount > 0 && paidAmount < invoiceAmount) {
      return { color: "orange", text: "éƒ¨åˆ†ä»˜æ¬¾" };
    }

    return { color: "blue", text: "å·²ç™¼é€" };
  };

  const { color, text } = getDisplayStatus();

  return (
    <Badge variant="light" color={color}>
      {text}
    </Badge>
  );
}
```

### 2. å¿«é€Ÿæ”¶æ¬¾ Modal

```tsx
interface QuickPaymentModalProps {
  invoice: InvoiceListItem;
  onClose: () => void;
  onSuccess: () => void;
}

export function QuickPaymentModal({
  invoice,
  onClose,
  onSuccess,
}: QuickPaymentModalProps) {
  const [formData, setFormData] = useState({
    paymentDate: new Date(),
    amount: invoice.pendingAmount,
    method: "FPS" as PaymentMethod,
    transactionNumber: "",
  });
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleSubmit = async () => {
    setIsSubmitting(true);

    try {
      await fetch(`/api/invoices/${invoice.id}/payment`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      onSuccess();
      onClose();
    } catch (error) {
      console.error("è¨˜éŒ„æ”¶æ¬¾å¤±æ•—:", error);
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <Modal isOpen onClose={onClose} className="max-w-md">
      <div className="p-6">
        <h3 className="text-lg font-semibold mb-4">è¨˜éŒ„æ”¶æ¬¾</h3>

        {/* ç™¼ç¥¨è³‡è¨Š */}
        <div className="mb-4 p-3 bg-gray-50 rounded-lg dark:bg-gray-800">
          <p className="text-sm text-gray-500">ç™¼ç¥¨ç·¨è™Ÿ</p>
          <p className="font-medium">{invoice.invoiceNumber}</p>
          <p className="text-sm text-gray-500 mt-2">å¾…æ”¶é‡‘é¡</p>
          <p className="font-medium text-lg">
            HK$ {invoice.pendingAmount.toLocaleString()}
          </p>
        </div>

        {/* è¡¨å–® */}
        <div className="space-y-4">
          <div>
            <Label>ä»˜æ¬¾æ—¥æœŸ *</Label>
            <DatePicker
              value={formData.paymentDate}
              onChange={(date) =>
                setFormData((prev) => ({ ...prev, paymentDate: date }))
              }
            />
          </div>

          <div>
            <Label>æ”¶æ¬¾é‡‘é¡ (HK$) *</Label>
            <Input
              type="number"
              value={formData.amount}
              onChange={(e) =>
                setFormData((prev) => ({
                  ...prev,
                  amount: Number(e.target.value),
                }))
              }
            />
          </div>

          <div>
            <Label>ä»˜æ¬¾æ–¹å¼ *</Label>
            <Select
              value={formData.method}
              onChange={(value) =>
                setFormData((prev) => ({ ...prev, method: value }))
              }
              options={[
                { value: "FPS", label: "è½‰æ•¸å¿« (FPS)" },
                { value: "CHEQUE", label: "æ”¯ç¥¨" },
                { value: "BANK_TRANSFER", label: "éŠ€è¡Œè½‰å¸³" },
                { value: "CASH", label: "ç¾é‡‘" },
              ]}
            />
          </div>

          <div>
            <Label>äº¤æ˜“ç·¨è™Ÿ</Label>
            <Input
              value={formData.transactionNumber}
              onChange={(e) =>
                setFormData((prev) => ({
                  ...prev,
                  transactionNumber: e.target.value,
                }))
              }
              placeholder="å¦‚ï¼šFPS202412051430"
            />
          </div>
        </div>

        <div className="flex gap-3 mt-6">
          <Button variant="outline" onClick={onClose} className="flex-1">
            å–æ¶ˆ
          </Button>
          <Button
            variant="primary"
            onClick={handleSubmit}
            disabled={isSubmitting}
            className="flex-1"
          >
            {isSubmitting ? "è™•ç†ä¸­..." : "ç¢ºèªæ”¶æ¬¾"}
          </Button>
        </div>
      </div>
    </Modal>
  );
}
```

### 3. è¡Œæ“ä½œ

```typescript
function getRowActions(
  invoice: InvoiceListItem,
  role: UserRole,
  handlers: {
    onView: () => void;
    onRecordPayment: () => void;
    onSendReminder: () => void;
    onDownloadPdf: () => void;
    onViewReceipt: () => void;
  }
) {
  const actions = [];

  // æŸ¥çœ‹ - æ‰€æœ‰äºº
  actions.push({
    label: "æŸ¥çœ‹",
    onClick: handlers.onView,
  });

  // å”¯è®€è§’è‰²åˆ°æ­¤ç‚ºæ­¢
  if (role === "SCHOOL_ADMIN") {
    return actions;
  }

  // ä¸‹è¼‰ PDF
  if (invoice.status !== "DRAFT") {
    actions.push({
      label: "ä¸‹è¼‰ PDF",
      onClick: handlers.onDownloadPdf,
    });
  }

  // è¨˜éŒ„æ”¶æ¬¾ - æœªä»˜æ¸…
  if (["SENT", "OVERDUE", "PARTIAL"].includes(invoice.status)) {
    actions.push({
      label: "è¨˜éŒ„æ”¶æ¬¾",
      onClick: handlers.onRecordPayment,
      highlight: true,
    });
  }

  // å‚¬æ¬¾ - å·²é€¾æœŸ
  if (invoice.daysOverdue && invoice.daysOverdue > 0) {
    actions.push({
      label: "ç™¼é€å‚¬æ¬¾",
      onClick: handlers.onSendReminder,
    });
  }

  // æŸ¥çœ‹æ”¶æ“š - å·²ä»˜æ¬¾
  if (invoice.status === "PAID") {
    actions.push({
      label: "æŸ¥çœ‹æ”¶æ“š",
      onClick: handlers.onViewReceipt,
    });
  }

  return actions;
}
```

---

## ğŸ’» ç¨‹å¼ç¢¼ç¯„ä¾‹

### é é¢çµæ§‹

```tsx
// app/(private)/dashboard/school/invoices/page.tsx
"use client";

import { useState } from "react";
import { useSession } from "next-auth/react";
import { useRouter } from "next/navigation";
import useSWR from "swr";
import Link from "next/link";
import { PageBreadCrumb } from "@/components/common/PageBreadCrumb";
import { InvoiceStatusBadge } from "./components/InvoiceStatusBadge";
import { QuickPaymentModal } from "./components/QuickPaymentModal";
import { InvoiceSummaryCard } from "./components/InvoiceSummaryCard";
import { TableDropdown } from "@/components/common/TableDropdown";
import { Pagination } from "@/components/ui/pagination";

export default function InvoicesPage() {
  const { data: session } = useSession();
  const router = useRouter();

  const [status, setStatus] = useState<string>("all");
  const [page, setPage] = useState(1);
  const [paymentModal, setPaymentModal] = useState<InvoiceListItem | null>(
    null
  );

  const canEdit = ["ADMIN", "FINANCE"].includes(session?.user?.role || "");

  const queryString = new URLSearchParams({
    ...(status !== "all" && { status }),
    page: page.toString(),
  }).toString();

  const { data, isLoading, mutate } = useSWR(
    `/api/invoices?${queryString}`,
    fetcher
  );

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <PageBreadCrumb title="ç™¼ç¥¨ç®¡ç†" />

        {canEdit && (
          <Link href="/dashboard/school/invoices/generate">
            <Button variant="primary">
              <PlusIcon className="h-4 w-4 mr-2" />
              ç”Ÿæˆç™¼ç¥¨
            </Button>
          </Link>
        )}
      </div>

      {/* ç¯©é¸å™¨ */}
      <div className="flex flex-wrap gap-4">
        <div className="flex gap-2">
          {[
            { value: "all", label: "å…¨éƒ¨" },
            { value: "DRAFT", label: "è‰ç¨¿" },
            { value: "SENT", label: "å·²ç™¼é€" },
            { value: "OVERDUE", label: "å·²é€¾æœŸ" },
            { value: "PAID", label: "å·²ä»˜æ¬¾" },
          ].map((opt) => (
            <button
              key={opt.value}
              onClick={() => {
                setStatus(opt.value);
                setPage(1);
              }}
              className={cn(
                "px-3 py-1.5 rounded-full text-sm transition-colors",
                status === opt.value
                  ? "bg-primary-500 text-white"
                  : "bg-gray-100 text-gray-600 hover:bg-gray-200"
              )}
            >
              {opt.label}
            </button>
          ))}
        </div>
      </div>

      {/* è¡¨æ ¼ */}
      <div className="rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900 overflow-hidden">
        <table className="w-full">
          <thead>
            <tr className="border-b border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-800/50">
              <th className="px-4 py-3 text-left text-sm font-medium text-gray-500">
                ç™¼ç¥¨ç·¨è™Ÿ
              </th>
              <th className="px-4 py-3 text-left text-sm font-medium text-gray-500">
                å­¸æ ¡
              </th>
              <th className="px-4 py-3 text-right text-sm font-medium text-gray-500">
                é‡‘é¡
              </th>
              <th className="px-4 py-3 text-left text-sm font-medium text-gray-500">
                åˆ°æœŸæ—¥
              </th>
              <th className="px-4 py-3 text-left text-sm font-medium text-gray-500">
                ç‹€æ…‹
              </th>
              <th className="px-4 py-3 text-right text-sm font-medium text-gray-500">
                æ“ä½œ
              </th>
            </tr>
          </thead>
          <tbody>
            {data?.data.map((invoice: InvoiceListItem) => (
              <tr
                key={invoice.id}
                className={cn(
                  "border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50",
                  invoice.daysOverdue &&
                    invoice.daysOverdue > 0 &&
                    "bg-red-50 dark:bg-red-900/10"
                )}
              >
                <td className="px-4 py-3 text-sm font-medium">
                  {invoice.invoiceNumber}
                </td>
                <td className="px-4 py-3 text-sm">
                  {invoice.school.schoolName}
                </td>
                <td className="px-4 py-3 text-sm text-right font-medium">
                  HK$ {invoice.invoiceAmount.toLocaleString()}
                </td>
                <td className="px-4 py-3 text-sm text-gray-500">
                  {invoice.dueDate
                    ? format(invoice.dueDate, "yyyy/MM/dd")
                    : "-"}
                </td>
                <td className="px-4 py-3">
                  <InvoiceStatusBadge
                    status={invoice.status}
                    dueDate={invoice.dueDate}
                    paidAmount={invoice.paidAmount}
                    invoiceAmount={invoice.invoiceAmount}
                  />
                </td>
                <td className="px-4 py-3 text-right">
                  <TableDropdown
                    items={getRowActions(invoice, session?.user?.role, {
                      onView: () =>
                        router.push(`/dashboard/school/invoices/${invoice.id}`),
                      onRecordPayment: () => setPaymentModal(invoice),
                      onSendReminder: () => handleSendReminder(invoice.id),
                      onDownloadPdf: () => handleDownloadPdf(invoice.id),
                      onViewReceipt: () =>
                        router.push(
                          `/dashboard/school/invoices/${invoice.id}?tab=receipt`
                        ),
                    })}
                  />
                </td>
              </tr>
            ))}
          </tbody>
        </table>

        {/* åˆ†é  */}
        {data?.pagination && (
          <div className="px-4 py-3 border-t border-gray-200 dark:border-gray-800 flex items-center justify-between">
            <span className="text-sm text-gray-500">
              é¡¯ç¤º {(data.pagination.page - 1) * data.pagination.pageSize + 1}-
              {Math.min(
                data.pagination.page * data.pagination.pageSize,
                data.pagination.total
              )}{" "}
              / å…± {data.pagination.total} å¼µ
            </span>
            <Pagination
              currentPage={data.pagination.page}
              totalPages={data.pagination.totalPages}
              onPageChange={setPage}
            />
          </div>
        )}
      </div>

      {/* çµ±è¨ˆæ‘˜è¦ */}
      <InvoiceSummaryCard />

      {/* å¿«é€Ÿæ”¶æ¬¾ Modal */}
      {paymentModal && (
        <QuickPaymentModal
          invoice={paymentModal}
          onClose={() => setPaymentModal(null)}
          onSuccess={() => mutate()}
        />
      )}
    </div>
  );
}
```

---

## âœ… é©—æ”¶æ¨™æº–

- [ ] ADMIN/FINANCE å¯æŸ¥çœ‹æ‰€æœ‰ç™¼ç¥¨
- [ ] SCHOOL_ADMIN åªèƒ½æŸ¥çœ‹è‡ªå·±å­¸æ ¡çš„ç™¼ç¥¨
- [ ] ç‹€æ…‹ç¯©é¸æ­£ç¢ºé‹ä½œ
- [ ] é€¾æœŸç™¼ç¥¨ç´…è‰²é«˜äº®é¡¯ç¤º
- [ ] å¯å¿«é€Ÿè¨˜éŒ„æ”¶æ¬¾
- [ ] å¯ç™¼é€å‚¬æ¬¾æé†’
- [ ] åˆ†é åŠŸèƒ½æ­£å¸¸
- [ ] çµ±è¨ˆæ‘˜è¦é¡¯ç¤ºæ­£ç¢º
