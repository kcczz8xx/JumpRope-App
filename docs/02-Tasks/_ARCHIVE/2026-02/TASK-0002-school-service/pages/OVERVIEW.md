# ğŸ“Š ç®¡ç†å„€è¡¨æ¿ - Overview

> **è·¯å¾‘**: `/dashboard/school/overview`  
> **å„ªå…ˆç´š**: P0  
> **è§’è‰²**: ADMIN, SCHOOL_ADMIN

---

## ğŸ“‹ é é¢æ¦‚è¿°

ç®¡ç†å„€è¡¨æ¿æ˜¯ç®¡ç†å“¡å’Œå­¸æ ¡è² è²¬äººçš„ä¸»è¦å…¥å£ï¼Œæä¾›é—œéµæŒ‡æ¨™ã€æœ€è¿‘å‹•æ…‹å’Œå¿«é€Ÿæ“ä½œåŠŸèƒ½ã€‚

---

## ğŸ¨ é é¢çµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ç®¡ç†å„€è¡¨æ¿                                    [æ—¥æœŸç¯©é¸] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ ğŸ’° æœ¬æœˆæ”¶å…¥ â”‚ â”‚ ğŸ“š æ´»èºèª²ç¨‹ â”‚ â”‚ ğŸ“‹ å¾…ç™¼å ±åƒ¹ â”‚ â”‚ â° å¾…æ”¶æ¬¾   â”‚
â”‚  â”‚ HK$125,000  â”‚ â”‚    18 å€‹    â”‚ â”‚    3 ä»½     â”‚ â”‚ HK$45,000  â”‚
â”‚  â”‚ â†‘15% vsä¸Šæœˆâ”‚ â”‚ â†‘2 vsä¸Šæœˆ  â”‚ â”‚             â”‚ â”‚ 2å¼µå·²é€¾æœŸ  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ ğŸ“° æœ€è¿‘å‹•æ…‹                  â”‚ â”‚ ğŸš€ å¿«é€Ÿæ“ä½œ             â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸŸ¢ 2å°æ™‚å‰                   â”‚ â”‚ â”‚ â• æ–°å¢å ±åƒ¹         â”‚ â”‚
â”‚  â”‚ å­¸æ ¡Açš„å ±åƒ¹è¢«æ¥å—            â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚                              â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”µ æ˜¨å¤©                      â”‚ â”‚ â”‚ ğŸ“š ç®¡ç†èª²ç¨‹         â”‚ â”‚
â”‚  â”‚ èª²ç¨‹ã€ŒèŠ±å¼è·³ç¹©ã€å®Œæˆç¬¬8å ‚    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚                              â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸŸ¡ 3å¤©å‰                     â”‚ â”‚ â”‚ ğŸ’³ ç”Ÿæˆç™¼ç¥¨         â”‚ â”‚
â”‚  â”‚ ç™¼ç¥¨ INV-2024-012 å·²æ”¶æ¬¾     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚                              â”‚ â”‚                         â”‚
â”‚  â”‚ [ æŸ¥çœ‹æ›´å¤š ]                 â”‚ â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© ä½¿ç”¨çµ„ä»¶

### TailAdmin çµ„ä»¶

| çµ„ä»¶             | è·¯å¾‘                                   | ç”¨é€”         |
| ---------------- | -------------------------------------- | ------------ |
| `CardWithIcon`   | `components/cards/card-with-icon/`     | æŒ‡æ¨™å¡ç‰‡     |
| `PageBreadCrumb` | `components/common/PageBreadCrumb.tsx` | é é¢æ¨™é¡Œ     |
| `Button`         | `components/ui/button/`                | å¿«é€Ÿæ“ä½œæŒ‰éˆ• |
| `Badge`          | `components/ui/badge/Badge.tsx`        | ç‹€æ…‹æ¨™ç±¤     |

### éœ€é–‹ç™¼çµ„ä»¶

| çµ„ä»¶               | èªªæ˜               |
| ------------------ | ------------------ |
| `MetricCard`       | æŒ‡æ¨™å¡ç‰‡ï¼ˆå«è¶¨å‹¢ï¼‰ |
| `ActivityTimeline` | å‹•æ…‹æ™‚é–“ç·š         |
| `QuickActionPanel` | å¿«é€Ÿæ“ä½œé¢æ¿       |

---

## ğŸ“Š æŒ‡æ¨™å¡ç‰‡è¨­è¨ˆ

### 1. æœ¬æœˆç¸½æ”¶å…¥

```typescript
interface RevenueMetric {
  currentMonth: number; // æœ¬æœˆæ”¶å…¥
  previousMonth: number; // ä¸Šæœˆæ”¶å…¥
  percentageChange: number; // è®ŠåŒ–ç™¾åˆ†æ¯”
}

// è³‡æ–™ä¾†æº
const revenue = await prisma.schoolReceipt.aggregate({
  where: {
    paymentConfirmedDate: {
      gte: startOfMonth,
      lte: endOfMonth,
    },
    paymentStatus: "CONFIRMED",
  },
  _sum: { actualReceivedAmount: true },
});
```

### 2. æ´»èºèª²ç¨‹æ•¸

```typescript
interface ActiveCoursesMetric {
  count: number;
  changeFromLastMonth: number;
}

// è³‡æ–™ä¾†æº
const activeCourses = await prisma.schoolCourse.count({
  where: {
    status: "ACTIVE",
    // SCHOOL_ADMIN: åŠ å…¥ schoolId éæ¿¾
    ...(isSchoolAdmin && { schoolId: userSchoolId }),
  },
});
```

### 3. å¾…ç™¼é€å ±åƒ¹

```typescript
// è³‡æ–™ä¾†æº
const pendingQuotations = await prisma.schoolQuotation.count({
  where: {
    status: "DRAFT",
    ...(isSchoolAdmin && { schoolId: userSchoolId }),
  },
});
```

### 4. å¾…æ”¶æ¬¾é‡‘é¡

```typescript
interface PendingPaymentMetric {
  totalAmount: number;
  overdueCount: number;
  overdueAmount: number;
}

// è³‡æ–™ä¾†æº
const pendingInvoices = await prisma.schoolInvoice.findMany({
  where: {
    status: { in: ["SENT", "OVERDUE"] },
    ...(isSchoolAdmin && { schoolId: userSchoolId }),
  },
  select: {
    invoiceAmount: true,
    paidAmount: true,
    dueDate: true,
  },
});

const overdueInvoices = pendingInvoices.filter(
  (inv) => inv.dueDate && new Date(inv.dueDate) < new Date()
);
```

---

## ğŸ“° æœ€è¿‘å‹•æ…‹è¨­è¨ˆ

### å‹•æ…‹é¡å‹

```typescript
type ActivityType =
  | "QUOTATION_ACCEPTED" // å ±åƒ¹è¢«æ¥å—
  | "QUOTATION_SENT" // å ±åƒ¹å·²ç™¼é€
  | "COURSE_CREATED" // èª²ç¨‹å·²å»ºç«‹
  | "LESSON_COMPLETED" // èª²å ‚å·²å®Œæˆ
  | "INVOICE_PAID" // ç™¼ç¥¨å·²æ”¶æ¬¾
  | "TUTOR_ASSIGNED"; // å°å¸«å·²åˆ†é…

interface Activity {
  id: string;
  type: ActivityType;
  title: string;
  description: string;
  timestamp: Date;
  relatedId?: string; // ç›¸é—œè¨˜éŒ„ ID
  relatedType?: string; // quotation | course | invoice
}
```

### å‹•æ…‹èšåˆæŸ¥è©¢

```typescript
// åˆä½µå¤šå€‹è³‡æ–™ä¾†æºçš„æœ€è¿‘å‹•æ…‹
async function getRecentActivities(limit: number = 10) {
  const [quotations, lessons, invoices] = await Promise.all([
    // æœ€è¿‘å ±åƒ¹è®ŠåŒ–
    prisma.schoolQuotation.findMany({
      where: {
        OR: [
          { status: "ACCEPTED", respondedDate: { gte: sevenDaysAgo } },
          { status: "SENT", sentDate: { gte: sevenDaysAgo } },
        ],
      },
      orderBy: { updatedAt: "desc" },
      take: 5,
      include: { school: true },
    }),

    // æœ€è¿‘å®Œæˆèª²å ‚
    prisma.schoolLesson.findMany({
      where: {
        lessonStatus: "COMPLETED",
        updatedAt: { gte: sevenDaysAgo },
      },
      orderBy: { updatedAt: "desc" },
      take: 5,
      include: { course: { include: { school: true } } },
    }),

    // æœ€è¿‘æ”¶æ¬¾
    prisma.schoolReceipt.findMany({
      where: {
        paymentStatus: "CONFIRMED",
        createdAt: { gte: sevenDaysAgo },
      },
      orderBy: { createdAt: "desc" },
      take: 5,
      include: { invoice: true, school: true },
    }),
  ]);

  // åˆä½µä¸¦æ’åº
  const activities = [
    ...quotations.map((q) => ({
      type: q.status === "ACCEPTED" ? "QUOTATION_ACCEPTED" : "QUOTATION_SENT",
      title: `${q.school.schoolName}çš„å ±åƒ¹${
        q.status === "ACCEPTED" ? "è¢«æ¥å—" : "å·²ç™¼é€"
      }`,
      timestamp: q.status === "ACCEPTED" ? q.respondedDate : q.sentDate,
      relatedId: q.id,
      relatedType: "quotation",
    })),
    ...lessons.map((l) => ({
      type: "LESSON_COMPLETED",
      title: `èª²ç¨‹ã€Œ${l.course.courseName}ã€å®Œæˆç¬¬${l.lessonNumber}å ‚`,
      timestamp: l.updatedAt,
      relatedId: l.courseId,
      relatedType: "course",
    })),
    ...invoices.map((r) => ({
      type: "INVOICE_PAID",
      title: `ç™¼ç¥¨ ${r.invoice.invoiceNumber} å·²æ”¶æ¬¾`,
      timestamp: r.createdAt,
      relatedId: r.invoiceId,
      relatedType: "invoice",
    })),
  ];

  return activities
    .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())
    .slice(0, limit);
}
```

---

## ğŸš€ å¿«é€Ÿæ“ä½œ

### ADMIN è§’è‰²

```typescript
const adminQuickActions = [
  { label: "æ–°å¢å ±åƒ¹", href: "/dashboard/school/quotations/new", icon: "plus" },
  { label: "ç®¡ç†èª²ç¨‹", href: "/dashboard/school/courses", icon: "book" },
  {
    label: "ç”Ÿæˆç™¼ç¥¨",
    href: "/dashboard/school/invoices/generate",
    icon: "receipt",
  },
  { label: "å°å¸«æ’ç­", href: "/dashboard/school/schedule", icon: "calendar" },
];
```

### SCHOOL_ADMIN è§’è‰²

```typescript
const schoolAdminQuickActions = [
  { label: "æŸ¥çœ‹å ±åƒ¹", href: "/dashboard/school/quotations", icon: "document" },
  { label: "æŸ¥çœ‹èª²ç¨‹", href: "/dashboard/school/courses", icon: "book" },
  { label: "æŸ¥çœ‹ç™¼ç¥¨", href: "/dashboard/school/invoices", icon: "receipt" },
];
```

---

## ğŸ’» ç¨‹å¼ç¢¼ç¯„ä¾‹

### é é¢çµæ§‹

```tsx
// app/(private)/dashboard/school/overview/page.tsx
import { getServerSession } from "next-auth";
import { redirect } from "next/navigation";
import { PageBreadCrumb } from "@/components/common/PageBreadCrumb";
import { MetricCards } from "./components/MetricCards";
import { ActivityTimeline } from "./components/ActivityTimeline";
import { QuickActions } from "./components/QuickActions";

export default async function OverviewPage() {
  const session = await getServerSession();

  if (!session?.user) {
    redirect("/login");
  }

  const { role, schoolId } = session.user;

  // æ¬Šé™æª¢æŸ¥
  if (!["ADMIN", "SCHOOL_ADMIN"].includes(role)) {
    redirect("/dashboard/school/my-lessons");
  }

  // ç²å–è³‡æ–™
  const [metrics, activities] = await Promise.all([
    getMetrics(role, schoolId),
    getRecentActivities(role, schoolId),
  ]);

  return (
    <div className="space-y-6">
      <PageBreadCrumb title="ç®¡ç†å„€è¡¨æ¿" />

      {/* æŒ‡æ¨™å¡ç‰‡ */}
      <MetricCards metrics={metrics} />

      {/* ä¸»å…§å®¹å€ */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* æœ€è¿‘å‹•æ…‹ */}
        <div className="lg:col-span-2">
          <ActivityTimeline activities={activities} />
        </div>

        {/* å¿«é€Ÿæ“ä½œ */}
        <div>
          <QuickActions role={role} />
        </div>
      </div>
    </div>
  );
}
```

### MetricCards çµ„ä»¶

```tsx
// app/(private)/dashboard/school/overview/components/MetricCards.tsx
"use client";

import { CardWithIcon } from "@/components/cards/card-with-icon";

interface MetricCardsProps {
  metrics: {
    revenue: { current: number; change: number };
    activeCourses: { count: number; change: number };
    pendingQuotations: number;
    pendingPayment: { amount: number; overdueCount: number };
  };
}

export function MetricCards({ metrics }: MetricCardsProps) {
  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <MetricCard
        title="æœ¬æœˆç¸½æ”¶å…¥"
        value={`HK$ ${metrics.revenue.current.toLocaleString()}`}
        change={metrics.revenue.change}
        icon="dollar"
        href="/dashboard/school/invoices?status=paid"
      />

      <MetricCard
        title="æ´»èºèª²ç¨‹"
        value={`${metrics.activeCourses.count} å€‹`}
        change={metrics.activeCourses.change}
        changeLabel="vs ä¸Šæœˆ"
        icon="book"
        href="/dashboard/school/courses?status=active"
      />

      <MetricCard
        title="å¾…ç™¼é€å ±åƒ¹"
        value={`${metrics.pendingQuotations} ä»½`}
        icon="document"
        href="/dashboard/school/quotations?status=draft"
      />

      <MetricCard
        title="å¾…æ”¶æ¬¾é‡‘é¡"
        value={`HK$ ${metrics.pendingPayment.amount.toLocaleString()}`}
        subtitle={
          metrics.pendingPayment.overdueCount > 0
            ? `${metrics.pendingPayment.overdueCount} å¼µå·²é€¾æœŸ`
            : undefined
        }
        subtitleColor="red"
        icon="clock"
        href="/dashboard/school/invoices?status=pending"
      />
    </div>
  );
}

interface MetricCardProps {
  title: string;
  value: string;
  change?: number;
  changeLabel?: string;
  subtitle?: string;
  subtitleColor?: "green" | "red" | "gray";
  icon: string;
  href: string;
}

function MetricCard({
  title,
  value,
  change,
  changeLabel = "% vs ä¸Šæœˆ",
  subtitle,
  subtitleColor = "gray",
  icon,
  href,
}: MetricCardProps) {
  return (
    <Link href={href}>
      <div className="rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-gray-900 hover:shadow-md transition-shadow">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm text-gray-500 dark:text-gray-400">{title}</p>
            <p className="mt-1 text-2xl font-semibold text-gray-900 dark:text-white">
              {value}
            </p>

            {change !== undefined && (
              <p
                className={`mt-1 text-sm ${
                  change >= 0 ? "text-green-600" : "text-red-600"
                }`}
              >
                {change >= 0 ? "â†‘" : "â†“"} {Math.abs(change)}
                {changeLabel}
              </p>
            )}

            {subtitle && (
              <p className={`mt-1 text-sm text-${subtitleColor}-600`}>
                {subtitle}
              </p>
            )}
          </div>

          <div className="rounded-full bg-gray-100 p-3 dark:bg-gray-800">
            <Icon
              name={icon}
              className="h-6 w-6 text-gray-600 dark:text-gray-400"
            />
          </div>
        </div>
      </div>
    </Link>
  );
}
```

---

## ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆ

| æ–·é»                    | æŒ‡æ¨™å¡ç‰‡ | ä¸»å…§å®¹å€ |
| ----------------------- | -------- | -------- |
| mobile (< 640px)        | 1 åˆ—     | 1 åˆ—     |
| tablet (640px - 1024px) | 2 åˆ—     | 1 åˆ—     |
| desktop (> 1024px)      | 4 åˆ—     | 2:1 æ¯”ä¾‹ |

---

## ğŸ”„ è³‡æ–™æ›´æ–°

- **æŒ‡æ¨™å¡ç‰‡**: é é¢è¼‰å…¥æ™‚ç²å–ï¼Œæ”¯æ´æ‰‹å‹•åˆ·æ–°
- **æœ€è¿‘å‹•æ…‹**: åˆå§‹è¼‰å…¥ 10 æ¢ï¼Œæ”¯æ´ã€ŒæŸ¥çœ‹æ›´å¤šã€è¼‰å…¥æ›´å¤š
- **è‡ªå‹•åˆ·æ–°**: å¯é¸ï¼Œæ¯ 5 åˆ†é˜è‡ªå‹•åˆ·æ–°ï¼ˆä½¿ç”¨ SWRï¼‰

---

## âœ… é©—æ”¶æ¨™æº–

- [ ] ADMIN å¯æŸ¥çœ‹æ‰€æœ‰å­¸æ ¡çš„è³‡æ–™
- [ ] SCHOOL_ADMIN åªèƒ½æŸ¥çœ‹è‡ªå·±å­¸æ ¡çš„è³‡æ–™
- [ ] æŒ‡æ¨™å¡ç‰‡é¡¯ç¤ºæ­£ç¢ºæ•¸æ“š
- [ ] é»æ“ŠæŒ‡æ¨™å¡ç‰‡å¯è·³è½‰åˆ°ç›¸æ‡‰é é¢
- [ ] æœ€è¿‘å‹•æ…‹æŒ‰æ™‚é–“æ’åº
- [ ] å¿«é€Ÿæ“ä½œæŒ‰éˆ•æ­£ç¢ºè·³è½‰
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆæ­£å¸¸é‹ä½œ
