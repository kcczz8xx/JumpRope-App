# 原子化欄位系統 - 決策記錄

## DEC-001：欄位組件放置位置

**日期**：2026-02-03  
**狀態**：已決定

### 問題

原子化欄位組件應該放在哪裡？

### 選項

| 選項                       | 優點               | 缺點                  |
| :------------------------- | :----------------- | :-------------------- |
| A. `components/ui/fields/` | 全局可用           | 可能與 shadcn/ui 混淆 |
| B. `features/_core/`       | 符合 Feature-First | 需建立新 feature      |
| C. `lib/components/`       | 工具性質           | 不符合現有結構        |

### 決定

**選擇 B：`features/_core/`**

### 原因

1. 符合 Feature-First 架構
2. 可透過 `index.ts` 控制公開 API
3. 與 `_core` 的命名暗示「核心共用」
4. 避免與 UI 庫（shadcn）混淆

---

## DEC-002：欄位模式設計

**日期**：2026-02-03  
**狀態**：已決定

### 問題

如何支援不同顯示模式？

### 選項

| 選項                                    | 優點     | 缺點       |
| :-------------------------------------- | :------- | :--------- |
| A. 單一組件 + mode prop                 | 代碼集中 | 組件複雜   |
| B. 分開組件（PhoneInput, PhoneDisplay） | 職責單一 | 檔案數量多 |
| C. Render props / Compound              | 靈活     | 使用複雜   |

### 決定

**選擇 A：單一組件 + mode prop**

### 原因

1. 大多數情況下邏輯相似，只是渲染不同
2. 減少 import 數量
3. 切換模式只需改 prop

---

## DEC-003：Enum 欄位實作方式

**日期**：2026-02-03  
**狀態**：已決定

### 問題

8 個 Enum 欄位如何高效實作？

### 選項

| 選項                            | 優點     | 缺點       |
| :------------------------------ | :------- | :--------- |
| A. 逐個手寫                     | 可定制   | 重複代碼多 |
| B. 工廠函數 `createEnumField()` | 統一行為 | 靈活性稍低 |
| C. Generic 組件 + 配置          | 極簡     | 類型複雜   |

### 決定

**選擇 B：工廠函數**

### 原因

1. 統一行為和樣式
2. 只需配置 options 和標籤
3. 類型安全（每個 Enum 獨立類型）

---

## DEC-004：驗證邏輯位置

**日期**：2026-02-03  
**狀態**：已決定

### 問題

Zod 驗證應該放在欄位組件內還是父組件？

### 選項

| 選項                                     | 優點     | 缺點           |
| :--------------------------------------- | :------- | :------------- |
| A. 欄位內部驗證                          | 自包含   | 難以自定義規則 |
| B. 父組件驗證，error prop 傳入           | 靈活     | 需額外接線     |
| C. 混合（欄位基礎驗證 + 父組件業務驗證） | 分層清晰 | 複雜度高       |

### 決定

**選擇 B：父組件驗證，error prop 傳入**

### 原因

1. 欄位組件保持純粹（只負責渲染）
2. 驗證規則可根據場景調整
3. 與 react-hook-form / Zod 整合更容易

---

## DEC-005：Model-Aligned 文件夾組織

**日期**：2026-02-03  
**狀態**：已決定

### 問題

欄位組件應該如何分組？

### 選項

| 選項                                       | 優點           | 缺點             |
| :----------------------------------------- | :------------- | :--------------- |
| A. 按類型分（\_base, \_enum, \_composite） | 直觀           | 與 Prisma 無關聯 |
| B. 按 Model 分（school, course, lesson）   | 與 Prisma 對齊 | 需記住對應關係   |
| C. 混合（\_shared + Model 分組）           | 兼顧共用和專屬 | 稍複雜           |

### 決定

**選擇 C：混合模式（\_shared + Model 分組）**

### 原因

1. **AI 輔助開發**：文件夾與 `prisma/schema/` 對齊，方便定位
2. **跨 Model 共用**：Phone, Email 等放 `_shared/`，避免重複
3. **專屬欄位歸位**：CourseStatusField 放 `course/`，InvoiceStatusField 放 `invoice/`
4. **Debug 友善**：從 Prisma Model 直接對應到 Fields 文件夾

### 對照表

| Prisma 路徑                     | Fields 路徑       |
| :------------------------------ | :---------------- |
| `prisma/schema/school/`         | `fields/school/`  |
| `prisma/schema/school/course/`  | `fields/course/`  |
| `prisma/schema/school/lesson/`  | `fields/lesson/`  |
| `prisma/schema/school/invoice/` | `fields/invoice/` |
| （跨 Model 共用）               | `fields/_shared/` |

---

## DEC-006：開發規範補充

**日期**：2026-02-03  
**狀態**：已決定

### 問題

如何確保欄位組件風格一致？

### 決定

新增 3 條開發規範：

1. **規範 A：命名一致性** — 統一 `XxxField.tsx`，不含 Base 前綴
2. **規範 B：Props 結構順序** — 數據 → 模式 → 狀態 → 標籤 → 樣式
3. **規範 C：文件放置原則** — 跨 Model 共用放 `_shared/`，專屬放對應文件夾

### 原因

1. AI 輔助開發時減少猜測
2. 代碼審查時快速定位問題
3. 新成員容易上手
